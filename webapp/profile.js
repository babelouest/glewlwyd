!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var a=t();for(var l in a)("object"==typeof exports?exports:e)[l]=a[l]}}(window,(function(){return function(e){function t(t){for(var l,i,r=t[0],o=t[1],c=t[2],u=0,f=[];u<r.length;u++)i=r[u],Object.prototype.hasOwnProperty.call(n,i)&&n[i]&&f.push(n[i][0]),n[i]=0;for(l in o)Object.prototype.hasOwnProperty.call(o,l)&&(e[l]=o[l]);for(d&&d(t);f.length;)f.shift()();return s.push.apply(s,c||[]),a()}function a(){for(var e,t=0;t<s.length;t++){for(var a=s[t],l=!0,r=1;r<a.length;r++){var o=a[r];0!==n[o]&&(l=!1)}l&&(s.splice(t--,1),e=i(i.s=a[0]))}return e}var l={},n={3:0},s=[];function i(t){if(l[t])return l[t].exports;var a=l[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,i),a.l=!0,a.exports}i.m=e,i.c=l,i.d=function(e,t,a){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(i.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var l in e)i.d(a,l,function(t){return e[t]}.bind(null,l));return a},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="";var r=window.webpackJsonp=window.webpackJsonp||[],o=r.push.bind(r);r.push=t,r=r.slice();for(var c=0;c<r.length;c++)t(r[c]);var d=o;return s.push([70,0,4]),a()}({12:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});function l(e,t){for(var a=0;a<t.length;a++){var l=t[a];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(e,l.key,l)}}var n=a(0),s=r(n),i=r(a(1));function r(e){return e&&e.__esModule?e:{default:e}}var o=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(c,n.Component),function(e,t,a){t&&l(e.prototype,t),a&&l(e,a)}(c,[{key:"componentWillReceiveProps",value:function(e){this.setState({title:e.title,message:e.message,cb:e.callback})}},{key:"closeModal",value:function(e,t){this.state.cb&&this.state.cb(t)}},{key:"render",value:function(){var e=this;return s.default.createElement("div",{className:"modal fade",id:"confirmModal",tabIndex:"-1",role:"dialog","aria-labelledby":"confirmModalLabel","aria-hidden":"true"},s.default.createElement("div",{className:"modal-dialog",role:"document"},s.default.createElement("div",{className:"modal-content"},s.default.createElement("div",{className:"modal-header"},s.default.createElement("h5",{className:"modal-title",id:"confirmModalLabel"},this.state.title),s.default.createElement("button",{type:"button",className:"close","aria-label":i.default.t("modal.close"),onClick:function(t){return e.closeModal(t,!1)}},s.default.createElement("span",{"aria-hidden":"true"},"×"))),s.default.createElement("div",{className:"modal-body"},this.state.message),s.default.createElement("div",{className:"modal-footer"},s.default.createElement("button",{type:"button",className:"btn btn-secondary",onClick:function(t){return e.closeModal(t,!1)}},i.default.t("modal.close")),s.default.createElement("button",{type:"button",className:"btn btn-primary",onClick:function(t){return e.closeModal(t,!0)}},i.default.t("modal.ok"))))))}}]),c);function c(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c);var t=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(c.__proto__||Object.getPrototypeOf(c)).call(this,e));return t.state={title:e.title,message:e.message,cb:e.callback},t.closeModal=t.closeModal.bind(t),t}t.default=o},2:function(e,t,a){"use strict";function l(e,t){for(var a=0;a<t.length;a++){var l=t[a];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(e,l.key,l)}}function n(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),this.subscriberList={}}Object.defineProperty(t,"__esModule",{value:!0});var s=new(function(e,t,a){t&&l(e.prototype,t)}(n,[{key:"subscribe",value:function(e,t){this.subscriberList[e]=t}},{key:"sendMessage",value:function(e,t){if(Array.isArray(e)||(e=[e]),"broadcast"===e[0])this.subscriberList.forEach((function(e,a){e({type:"broadcast",message:t})}));else for(var a in this.subscriberList)0<=e.indexOf(a)&&this.subscriberList[a](t)}}]),n);t.default=s},3:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});function l(e,t){for(var a=0;a<t.length;a++){var l=t[a];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(e,l.key,l)}}var n,s=(n=a(2))&&n.__esModule?n:{default:n};function i(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),this.GlewlwydApiPrefix="",this.GlewlwydApiPrefixSub=""}var r=new(function(e,t,a){t&&l(e.prototype,t),a&&l(e,a)}(i,[{key:"setConfig",value:function(e){this.GlewlwydApiPrefix=e}},{key:"getConfig",value:function(e){return this.GlewlwydApiPrefix}},{key:"setConfigSub",value:function(e){this.GlewlwydApiPrefixSub=e}},{key:"getConfigSub",value:function(e){return this.GlewlwydApiPrefixSub}},{key:"request",value:function(e,t,a){var l=1<arguments.length&&void 0!==t?t:"GET",n=2<arguments.length&&void 0!==a&&a;return n&&"GET"!==l?$.ajax({method:l,url:e,data:JSON.stringify(n),contentType:"application/json; charset=utf-8"}):$.ajax({method:l,url:e})}},{key:"glewlwydRequest",value:function(e,t,a,l){var n=1<arguments.length&&void 0!==t?t:"GET",i=2<arguments.length&&void 0!==a&&a,r=3<arguments.length&&void 0!==l&&l;return this.request(this.GlewlwydApiPrefix+e,n,i).fail((function(e){r&&401===e.status&&s.default.sendMessage("App",{type:"loggedIn",message:!1})}))}},{key:"glewlwydRequestSub",value:function(e,t,a){var l=1<arguments.length&&void 0!==t?t:"GET",n=2<arguments.length&&void 0!==a&&a;return this.request(this.GlewlwydApiPrefixSub+e,l,n)}}]),i);t.default=r},6:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});function l(e,t){for(var a=0;a<t.length;a++){var l=t[a];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(e,l.key,l)}}var n=a(0),s=r(n),i=r(a(2));function r(e){return e&&e.__esModule?e:{default:e}}var o=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(c,n.Component),function(e,t,a){t&&l(e.prototype,t),a&&l(e,a)}(c,[{key:"timeoutClose",value:function(e){var t=this;setTimeout((function(){t.close(e)}),5e3)}},{key:"close",value:function(e){var t=this,a=this.state.message;a.forEach((function(l,n){l.id===e&&(a.splice(n,1),t.setState({message:a}))}))}},{key:"render",value:function(){var e=this,t=[];return this.state.message.forEach((function(a,l){var n;n="success"===a.type?s.default.createElement("strong",{className:"mr-auto"},s.default.createElement("span",{className:"badge badge-success btn-icon"},s.default.createElement("i",{className:"fas fa-check-circle"})),"Glewlwyd"):"danger"===a.type?s.default.createElement("strong",{className:"mr-auto"},s.default.createElement("span",{className:"badge badge-danger btn-icon"},s.default.createElement("i",{className:"fas fa-exclamation-circle"})),"Glewlwyd"):"warning"===a.type?s.default.createElement("strong",{className:"mr-auto"},s.default.createElement("span",{className:"badge badge-warning btn-icon"},s.default.createElement("i",{className:"fas fa-exclamation-circle"})),"Glewlwyd"):s.default.createElement("strong",{className:"mr-auto"},s.default.createElement("span",{className:"badge badge-info btn-icon"},s.default.createElement("i",{className:"fas fa-info-circle"})),"Glewlwyd"),t.push(s.default.createElement("div",{className:"toast-container",style:{top:85+90*l,right:5},key:l},s.default.createElement("div",{className:"toast",role:"alert","aria-live":"assertive","aria-atomic":"true"},s.default.createElement("div",{className:"toast-header"},n,s.default.createElement("button",{type:"button",className:"ml-2 mb-1 close","data-dismiss":"toast","aria-label":"Close",onClick:function(){return e.close(a.id)}},s.default.createElement("span",{"aria-hidden":"true"},"×"))),s.default.createElement("div",{className:"toast-body"},a.message))))})),s.default.createElement("div",null,t)}}]),c);function c(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c);var t=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(c.__proto__||Object.getPrototypeOf(c)).call(this,e));return t.state={message:[],counter:0},i.default.subscribe("Notification",(function(e){if(e.type){var a=t.state.message;a.push({type:e.type,message:e.message,id:t.state.counter}),t.setState({message:a,counter:t.state.counter+1},(function(){t.timeoutClose(t.state.counter-1)}))}})),t.close=t.close.bind(t),t.timeoutClose=t.timeoutClose.bind(t),t}t.default=o},70:function(e,t,a){"use strict";var l=d(a(0)),n=d(a(9)),s=d(a(1)),i=d(a(10)),r=d(a(11)),o=d(a(3)),c=d(a(71));function d(e){return e&&e.__esModule?e:{default:e}}function u(e,t){t=t||window.location.href,e=e.replace(/[\[\]]/g,"\\$&");var a=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(t);return a?a[2]?decodeURIComponent(a[2].replace(/\+/g," ")):"":null}try{s.default.use(i.default).use(r.default).init({fallbackLng:"en",ns:["translations"],defaultNS:"translations",backend:{loadPath:"locales/{{lng}}/{{ns}}.json"}}).then((function(){o.default.request("config.json").then((function(e){o.default.request(e.GlewlwydUrl+"config/").then((function(t){u("delegate")?o.default.setConfig(e.GlewlwydUrl+t.api_prefix+"/delegate/"+u("delegate")):o.default.setConfig(e.GlewlwydUrl+t.api_prefix),o.default.setConfigSub(e.GlewlwydUrl+t.api_prefix);var a=Object.assign({params:{scope:u("scope"),client_id:u("client_id"),callback_url:u("callback_url"),delegate:u("delegate")||!1}},e,t);n.default.render(l.default.createElement(c.default,{config:a}),document.getElementById("root"))})).fail((function(e){n.default.render(l.default.createElement(c.default,{config:!1}),document.getElementById("root"))}))}))}))}catch(e){$("#root").html('<div class="alert alert-danger" role="alert"><i class="fas fa-exclamation-triangle"></i><span class="btn-icon-right">You must use a browser compatible with Glewlwyd SSO</span></div>')}},71:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});function l(e,t){for(var a=0;a<t.length;a++){var l=t[a];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(e,l.key,l)}}var n=a(0),s=y(n),i=y(a(1)),r=y(a(3)),o=y(a(2)),c=y(a(6)),d=y(a(72)),u=y(a(73)),f=y(a(74)),m=y(a(75)),p=y(a(76)),h=y(a(77)),g=y(a(12)),b=y(a(83));function y(e){return e&&e.__esModule?e:{default:e}}var v=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(E,n.Component),function(e,t,a){t&&l(e.prototype,t),a&&l(e,a)}(E,[{key:"componentWillReceiveProps",value:function(e){this.setState({config:props.config})}},{key:"fetchProfile",value:function(){var e=this;this.state.config.params.delegate?r.default.glewlwydRequest("/profile/scheme").then((function(t){e.setState({loggedIn:!0,profileList:[{username:e.state.config.params.delegate}],schemeList:t,invalidCredentialMessage:!1,invalidDelegateMessage:!1})})).fail((function(t){e.setState({invalidCredentialMessage:!1,invalidDelegateMessage:!0},(function(){401===t.status?o.default.sendMessage("Notification",{type:"danger",message:i.default.t("profile.requires-admin-scope")}):o.default.sendMessage("Notification",{type:"danger",message:i.default.t("error-api-connect")})}))})):r.default.glewlwydRequest("/profile_list").then((function(t){!t[0]||t[0].scope.indexOf(e.state.config.profile_scope)<0?e.setState({invalidDelegateMessage:!0},(function(){o.default.sendMessage("Notification",{type:"danger",message:i.default.t("profile.requires-profile-scope")})})):e.setState({profileList:t},(function(){r.default.glewlwydRequest("/profile/scheme").then((function(t){e.setState({loggedIn:!0,schemeList:t,invalidDelegateMessage:!1,invalidCredentialMessage:!1})})).fail((function(t){e.setState({invalidDelegateMessage:!1,invalidCredentialMessage:!0},(function(){401===t.status?o.default.sendMessage("Notification",{type:"danger",message:i.default.t("profile.requires-profile-scope")}):o.default.sendMessage("Notification",{type:"danger",message:i.default.t("error-api-connect")})}))}))}))})).fail((function(t){e.setState({invalidDelegateMessage:!1,invalidCredentialMessage:!0},(function(){401===t.status?o.default.sendMessage("Notification",{type:"danger",message:i.default.t("profile.requires-profile-scope")}):o.default.sendMessage("Notification",{type:"danger",message:i.default.t("error-api-connect")})}))}))}},{key:"closePasswordModal",value:function(e,t){$("#passwordModal").modal("hide"),e&&o.default.sendMessage("Notification",{type:"success",message:i.default.t("profile.password-change-success")})}},{key:"render",value:function(){if(this.state.config){var e,t;return this.state.invalidCredentialMessage?e=s.default.createElement("div",{className:"alert alert-danger",role:"alert"},i.default.t("profile.error-credential-message")):this.state.invalidDelegateMessage&&(e=s.default.createElement("div",{className:"alert alert-danger",role:"alert"},i.default.t("admin.error-credential-message"))),t=this.state.config.params.delegate?s.default.createElement(m.default,{config:this.state.config,profile:!!this.state.profileList&&this.state.profileList[0]}):s.default.createElement(u.default,{config:this.state.config,profile:!!this.state.profileList&&this.state.profileList[0],pattern:!!this.state.config&&this.state.config.pattern.user}),s.default.createElement("div",{"aria-live":"polite","aria-atomic":"true",style:{position:"relative",minHeight:"200px"}},s.default.createElement("div",{className:"card center",id:"userCard",tabIndex:"-1",role:"dialog",style:{marginTop:"20px",marginBottom:"20px"}},s.default.createElement("div",{className:"card-header"},s.default.createElement(d.default,{active:this.state.curNav,config:this.state.config,loggedIn:this.state.loggedIn,schemeList:this.state.schemeList,profileList:this.state.profileList})),e,s.default.createElement("div",{className:"card-body"},s.default.createElement("div",{id:"carouselBody",className:"carousel slide","data-ride":"carousel"},s.default.createElement("div",{className:"carousel-inner"},s.default.createElement("div",{className:"carousel-item"+("profile"===this.state.curNav?" active":"")},t),s.default.createElement("div",{className:"carousel-item"+("session"===this.state.curNav?" active":"")},s.default.createElement(f.default,{config:this.state.config,profile:!!this.state.profileList&&this.state.profileList[0],loggedIn:this.state.loggedIn})),s.default.createElement("div",{className:"carousel-item"+("profile"!==this.state.curNav&&"session"!==this.state.curNav?" active":"")},s.default.createElement(h.default,{config:this.state.config,module:this.state.curNav,name:this.state.module,profile:!!this.state.profileList&&this.state.profileList[0]})))))),s.default.createElement(c.default,null),s.default.createElement(p.default,{config:this.state.config,callback:this.closePasswordModal}),s.default.createElement(g.default,{title:this.state.confirmModal.title,message:this.state.confirmModal.message,callback:this.state.confirmModal.callback}),s.default.createElement(b.default,{title:this.state.messageModal.title,message:this.state.messageModal.message}))}return s.default.createElement("div",{"aria-live":"polite","aria-atomic":"true",style:{position:"relative",minHeight:"200px"}},s.default.createElement("div",{className:"card center",id:"userCard",tabIndex:"-1",role:"dialog",style:{marginTop:"20px",marginBottom:"20px"}},s.default.createElement("div",{className:"card-header"},s.default.createElement("h4",null,s.default.createElement("span",{className:"badge badge-danger"},i.default.t("error-api-connect"))))))}}]),E);function E(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,E);var t=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(E.__proto__||Object.getPrototypeOf(E)).call(this,e));return t.state={lang:i.default.language,config:e.config,curNav:"profile",profileList:!1,schemeList:[],loggedIn:!1,confirmModal:{title:"",message:"",callback:!1},messageModal:{title:"",message:""},invalidCredentialMessage:!1,invalidDelegateMessage:!1},t.fetchProfile=t.fetchProfile.bind(t),t.closePasswordModal=t.closePasswordModal.bind(t),o.default.subscribe("App",(function(e){if("nav"===e.type)"password"===e.page?$("#passwordModal").modal({keyboard:!1,show:!0}):"session"===e.page?t.setState({curNav:"session"}):"profile"===e.page?t.setState({curNav:"profile"}):t.setState({curNav:e.module,module:e.page});else if("loggedIn"===e.type)t.setState({loggedIn:e.message},(function(){t.state.loggedIn?t.fetchProfile():t.setState({profileList:!1,schemeList:[]})}));else if("lang"===e.type)t.setState({lang:i.default.language});else if("profile"===e.type)t.fetchProfile();else if("confirm"===e.type){var a=t.state.confirmModal;a.title=e.title,a.message=e.message,a.callback=e.callback,t.setState({confirmModal:a},(function(){$("#confirmModal").modal({keyboard:!1,show:!0})}))}else if("message"===e.type){var l=t.state.messageModal;l.title=e.title,l.message=e.message,t.setState({messageModal:l},(function(){$("#messageModal").modal({keyboard:!1,show:!0})}))}else"closeConfirm"===e.type&&$("#confirmModal").modal("hide")})),t.state.config&&t.fetchProfile(),t}t.default=v},72:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});function l(e,t){for(var a=0;a<t.length;a++){var l=t[a];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(e,l.key,l)}}var n=a(0),s=c(n),i=c(a(1)),r=c(a(2)),o=c(a(3));function c(e){return e&&e.__esModule?e:{default:e}}var d=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(u,n.Component),function(e,t,a){t&&l(e.prototype,t),a&&l(e,a)}(u,[{key:"componentWillReceiveProps",value:function(e){this.setState({loggedIn:e.loggedIn,schemeList:e.schemeList,profileList:e.profileList})}},{key:"navigate",value:function(e,t,a){e.preventDefault(),r.default.sendMessage("App",{type:"nav",page:t,module:a}),this.setState({curNav:t})}},{key:"toggleLogin",value:function(){if(this.state.loggedIn)o.default.glewlwydRequest("/auth/?username="+encodeURIComponent(this.state.profileList[0].username),"DELETE").then((function(){r.default.sendMessage("Notification",{type:"info",message:i.default.t("login.success-delete-session")}),r.default.sendMessage("App",{type:"loggedIn",loggedIn:!1})})).fail((function(e){401!==e.status&&r.default.sendMessage("Notification",{type:"danger",message:i.default.t("login.error-delete-session")}),r.default.sendMessage("App",{type:"loggedIn",loggedIn:!1})}));else{var e=!1;this.state.config.sessionSchemes.forEach((function(t){t.scheme_default&&t.scheme_default.forEach((function(a){"profile"===a&&(e=t.scheme_name)}))})),document.location.href=this.state.config.LoginUrl+"?callback_url="+encodeURIComponent([location.protocol,"//",location.host,location.pathname].join(""))+"&scope="+encodeURIComponent(this.state.config.profile_scope)+(e?"&scheme="+encodeURIComponent(e):"")}}},{key:"changeLang",value:function(e,t){var a=this;i.default.changeLanguage(t).then((function(){a.setState({lang:t}),r.default.sendMessage("App",{type:"lang"})}))}},{key:"changeProfile",value:function(e,t){if(t)o.default.glewlwydRequest("/auth/","POST",{username:t.username}).then((function(){r.default.sendMessage("App",{type:"profile"})})).fail((function(){r.default.sendMessage("Notification",{type:"danger",message:i.default.t("login.error-login")})}));else{var a=!1;this.state.config.sessionSchemes.forEach((function(e){e.scheme_default&&e.scheme_default.forEach((function(t){"admin"===t&&(a=e.scheme_name)}))})),document.location.href=this.state.config.LoginUrl+"?callback_url="+encodeURIComponent([location.protocol,"//",location.host,location.pathname].join(""))+"&scope="+encodeURIComponent(this.state.config.profile_scope)+(a?"&scheme="+encodeURIComponent(a):"")}}},{key:"render",value:function(){var e,t,a,l=this,n=[],r=[],o=[];return["en","fr"].forEach((function(e,t){e===i.default.language?n.push(s.default.createElement("a",{className:"dropdown-item active",href:"#",key:t},e)):n.push(s.default.createElement("a",{className:"dropdown-item",href:"#",onClick:function(t){return l.changeLang(t,e)},key:t},e))})),this.state.schemeList.forEach((function(e,t){"retype-password"!==e.module&&"email"!==e.module&&r.push(s.default.createElement("li",{className:"nav-item"+(l.state.curNav===e.name?" active":""),key:t},s.default.createElement("a",{className:"nav-link",href:"#",onClick:function(t){return l.navigate(t,e.name,e.module)}},e.display_name||e.name)))})),!this.state.config.params.delegate&&this.state.profileList&&(t=s.default.createElement("li",{className:"nav-item"+("password"===this.state.curNav?" active":"")},s.default.createElement("a",{className:"nav-link",href:"#",onClick:function(e){return l.navigate(e,"password",null)}},i.default.t("profile.menu-password")))),this.state.profileList&&(a=s.default.createElement("li",{className:"nav-item"+("session"===this.state.curNav?" active":"")},s.default.createElement("a",{className:"nav-link",href:"#",onClick:function(e){return l.navigate(e,"session",null)}},i.default.t("profile.menu-session")))),this.state.profileList&&this.state.profileList.forEach((function(e,t){o.push(s.default.createElement("a",{className:"dropdown-item"+(t?"":" active"),href:"#",onClick:function(t){return l.changeProfile(t,e)},key:t},e.name||e.username))})),o.push(s.default.createElement("div",{className:"dropdown-divider",key:o.length})),o.push(s.default.createElement("a",{className:"dropdown-item",href:"#",onClick:function(e){return l.changeProfile(e,null)},key:o.length},i.default.t("profile.menu-session-new"))),e=s.default.createElement("div",{className:"btn-group",role:"group"},s.default.createElement("button",{className:"btn btn-secondary dropdown-toggle",type:"button",id:"dropdownProfile","data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false"},s.default.createElement("i",{className:"fas fa-user"})),s.default.createElement("div",{className:"dropdown-menu","aria-labelledby":"dropdownProfile"},o)),s.default.createElement("nav",{className:"navbar navbar-expand-lg navbar-light bg-light"},s.default.createElement("a",{className:"navbar-brand",href:"#"},"Glewlwyd"),s.default.createElement("button",{className:"navbar-toggler",type:"button","data-toggle":"collapse","data-target":"#navbarSupportedContent","aria-controls":"navbarSupportedContent","aria-expanded":"false","aria-label":"Toggle navigation"},s.default.createElement("span",{className:"navbar-toggler-icon"})),s.default.createElement("div",{className:"collapse navbar-collapse",id:"navbarSupportedContent"},s.default.createElement("ul",{className:"navbar-nav mr-auto"},s.default.createElement("li",{className:"nav-item"+("profile"===this.state.curNav?" active":"")},s.default.createElement("a",{className:"nav-link",href:"#",onClick:function(e){return l.navigate(e,"profile",null)}},i.default.t("profile.menu-user"))),a,t,r),s.default.createElement("div",{className:"btn-group",role:"group"},s.default.createElement("div",{className:"btn-group",role:"group"},s.default.createElement("button",{className:"btn btn-secondary dropdown-toggle",type:"button",id:"dropdownLang","data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false"},s.default.createElement("i",{className:"fas fa-globe-africa"})),s.default.createElement("div",{className:"dropdown-menu","aria-labelledby":"dropdownLang"},n)),e,s.default.createElement("button",{type:"button",className:"btn btn-secondary",onClick:this.toggleLogin},s.default.createElement("i",{className:"fas fa-sign-in-alt btn-icon"})))))}}]),u);function u(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u);var t=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(u.__proto__||Object.getPrototypeOf(u)).call(this,e));return t.state={config:e.config,curNav:"profile",loggedIn:e.loggedIn,schemeList:e.schemeList,profileList:e.profileList},r.default.subscribe("Navbar",(function(e){})),t.navigate=t.navigate.bind(t),t.toggleLogin=t.toggleLogin.bind(t),t.changeLang=t.changeLang.bind(t),t.changeProfile=t.changeProfile.bind(t),t}t.default=d},73:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});function l(e,t){for(var a=0;a<t.length;a++){var l=t[a];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(e,l.key,l)}}var n=a(0),s=c(n),i=c(a(1)),r=c(a(3)),o=c(a(2));function c(e){return e&&e.__esModule?e:{default:e}}c(a(6));var d=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(u,n.Component),function(e,t,a){t&&l(e.prototype,t),a&&l(e,a)}(u,[{key:"componentWillReceiveProps",value:function(e){this.setState({pattern:e.pattern,profile:e.profile,listAddValue:this.initListAdd(e.pattern),listEltConfirm:this.initListConfirm(e.pattern),listError:{}})}},{key:"createData",value:function(){var e={};this.state.pattern.forEach((function(t,a){t.list?e[t.name]=[]:t.defaultValue?e[t.name]=t.defaultValue:e[t.name]=""})),this.setState({data:e})}},{key:"initListAdd",value:function(e){var t={};return e&&e.forEach((function(e){e.list&&(t[e.name]="")})),t}},{key:"initListConfirm",value:function(e){var t={};return e&&e.forEach((function(e){e.confirm&&(t[e.name]="")})),t}},{key:"deleteListElt",value:function(e,t,a){var l=this.state.profile;l[t]&&(l[t].splice(a,1),this.setState({profile:l}))}},{key:"changeElt",value:function(e,t){var a=this.state.profile;a[t]=e.target.value,this.setState({profile:a})}},{key:"toggleBooleanElt",value:function(e,t){var a=this.state.profile;a[t]=!a[t],this.setState({profile:a})}},{key:"changeListAddElt",value:function(e,t){var a=this.state.listAddValue;a[t]=e.target.value,this.setState({listAddValue:a})}},{key:"AddListElt",value:function(e,t,a){var l=2<arguments.length&&void 0!==a&&a;if(e.preventDefault(),l)(n=this.state.profile)[t]||(n[t]=[]),n[t].push(l),this.setState({profile:n});else if(this.state.listAddValue[t]){var n=this.state.profile,s=this.state.listAddValue;n[t].push(this.state.listAddValue[t]),this.state.listAddValue[t]="",this.setState({profile:n,listAddValue:s})}}},{key:"changeEltConfirm",value:function(e,t){var a=this.state.listEltConfirm;a[t]=e.target.value,this.setState({listEltConfirm:a})}},{key:"changeTextArea",value:function(e,t,a){var l=this.state.profile;l[t]=a?e.target.value.split("\n"):e.target.value,this.setState({profile:l})}},{key:"uploadFile",value:function(e,t,a){var l=this,n=this.state.profile,s=e.target.files[0],i=new FileReader;i.onload=function(e){a?(n[t]||(n[t]=[]),n[t].push(s.name+"/"+btoa(e.target.result))):n[t]=s.name+"/"+btoa(e.target.result),l.setState({profile:n})},i.readAsText(s)}},{key:"uploadImage",value:function(e,t,a){var l=this,n=this.state.profile,s=e.target.files[0],i=new FileReader;i.onload=function(e){a?(n[t]||(n[t]=[]),n[t].push(btoa(e.target.result))):n[t]=btoa(e.target.result),l.setState({profile:n})},i.readAsBinaryString(s)}},{key:"removeImage",value:function(e,t,a){var l=this.state.profile;-1<a?l[t].splice(a,1):delete l[t],this.setState({profile:l})}},{key:"saveProfile",value:function(e){r.default.glewlwydRequest("/profile","PUT",this.state.profile).then((function(e){o.default.sendMessage("Notification",{type:"success",message:i.default.t("profile.save-profile-success")})})).fail((function(e){o.default.sendMessage("Notification",{type:"danger",message:i.default.t("profile.save-profile-error")})}))}},{key:"editElt",value:function(e,t,a){var l,n,r=this,o=[];if((void 0!==t||"password"===e.type||e.forceShow)&&e["profile-read"]){var c="",d="";if(this.state.listError[e.name]&&(c=" is-invalid",d=s.default.createElement("span",{className:"error-input"},i.default.t(this.state.listError[e.name]))),l=s.default.createElement("label",{htmlFor:"modal-edit-"+e.name},i.default.t(e.label)),e.list){if(t=t||[],e.listElements){var u=[];e.listElements.forEach((function(t,a){u.push(s.default.createElement("a",{className:"dropdown-item",key:a,href:"#",onClick:function(a){return r.AddListElt(a,e.name,t)}},t))})),n=s.default.createElement("div",{className:"dropdown"},s.default.createElement("button",{className:"btn btn-secondary btn-sm dropdown-toggle",type:"button",id:"modal-edit-"+e.name,"data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false"},s.default.createElement("i",{className:"fas fa-plus"})),s.default.createElement("div",{className:"dropdown-menu","aria-labelledby":"modal-edit-"+e.name},u))}else if("textarea"===e.type)n=s.default.createElement("textarea",{className:"form-control"+c,onChange:function(t){return r.changeTextArea(t,e.name,!0)},value:t.join("\n"),placeholder:e.placeholder?i.default.t(e.placeholder):""});else if("file"===e.type)n=e["profile-write"]||this.state.add?s.default.createElement("input",{type:"file",className:"form-control"+c,onChange:function(t){return r.uploadFile(t,e.name,!0)}}):s.default.createElement("input",{type:"file",disabled:!0,className:"form-control"});else if(e.type&&e.type.startsWith("image")){var f=[];t.forEach((function(t,a){f.push(s.default.createElement("a",{href:"#",onClick:function(t){return r.removeImage(t,e.name,a)},title:i.default.t("remove")},s.default.createElement("img",{key:a,className:"btn-icon-right img-thumb",src:"data:"+e.type+";base64,"+t,alt:e.name+"-"+a})))})),n=e.edit||this.state.add?s.default.createElement("div",null,s.default.createElement("div",{className:"custom-file"},s.default.createElement("input",{type:"file",className:"custom-file-input"+c,onChange:function(t){return r.uploadImage(t,e.name,!0)},id:"modal-image-"+e.name}),s.default.createElement("label",{className:"custom-file-label",htmlFor:"modal-image-"+e.name},i.default.t("browse"))),f):(f=[],t.forEach((function(t,a){f.push(s.default.createElement("img",{key:a,className:"btn-icon-right img-thumb",src:"data:"+e.type+";base64,"+t,alt:e.name+"-"+a}))})),f)}else e["profile-write"]&&(n=s.default.createElement("div",{className:"input-group"},s.default.createElement("input",{type:"text",className:"form-control"+c,id:"modal-edit-"+e.name,placeholder:e.placeholder?i.default.t(e.placeholder):"",onChange:function(t){return r.changeListAddElt(t,e.name)},value:this.state.listAddValue[e.name]}),s.default.createElement("div",{className:"input-group-append"},s.default.createElement("button",{className:"btn btn-outline-secondary",type:"button",onClick:function(t){return r.AddListElt(t,e.name)},title:i.default.t("modal.list-add-title")},s.default.createElement("i",{className:"fas fa-plus"})))));t.forEach((function(t,a){var l=t;"file"===e.type&&(l=t.substring(0,t.indexOf("/"))),(!e.type||"textarea"===e.type||e.type.startsWith("image"))&&e.type||(!0===e["profile-write"]||r.state.add?o.push(s.default.createElement("a",{href:"#",onClick:function(t){return r.deleteListElt(t,e.name,a)},key:a},s.default.createElement("span",{className:"badge badge-primary btn-icon-right"},l,s.default.createElement("span",{className:"badge badge-light btn-icon-right"},s.default.createElement("i",{className:"fas fa-times"}))))):o.push(s.default.createElement("span",{className:"badge badge-primary btn-icon-right",key:a},l)))}))}else n="boolean"===e.type?!0===e["profile-write"]||this.state.add?s.default.createElement("input",{type:"checkbox",className:"form-control"+c,id:"modal-edit-"+e.name,onChange:function(t){return r.toggleBooleanElt(t,e.name)},checked:t}):s.default.createElement("input",{disabled:!0,type:"checkbox",className:"form-control",id:"modal-edit-"+e.name,checked:t}):"textarea"===e.type?!0===e["profile-write"]||this.state.add?s.default.createElement("textarea",{className:"form-control"+c,onChange:function(t){return r.changeTextArea(t,e.name,!1)},value:t||"",placeholder:e.placeholder?i.default.t(e.placeholder):""}):s.default.createElement("textarea",{className:"form-control",disabled:!0,value:t||""}):"file"===e.type?(t&&o.push(s.default.createElement("a",{href:"#",key:0,onClick:function(t){return r.deleteFile(t,e.name)}},s.default.createElement("span",{className:"badge badge-primary"},t.substring(0,t.indexOf("/")),s.default.createElement("span",{className:"badge badge-light btn-icon-right"},s.default.createElement("i",{className:"fas fa-times"}))))),e["profile-write"]||this.state.add?s.default.createElement("input",{type:"file",className:"form-control"+c,onChange:function(t){return r.uploadFile(t,e.name)}}):s.default.createElement("input",{type:"file",disabled:!0,className:"form-control"})):e.type&&e.type.startsWith("image")?(t&&(f=s.default.createElement("a",{href:"#",onClick:function(t){return r.removeImage(t,e.name,-1)},title:i.default.t("remove")},s.default.createElement("img",{className:"btn-icon-right img-thumb",src:"data:"+e.type+";base64,"+t,alt:e.name}))),e.edit||this.state.add?s.default.createElement("div",null,s.default.createElement("div",{className:"custom-file"},s.default.createElement("input",{type:"file",className:"custom-file-input"+c,onChange:function(t){return r.uploadImage(t,e.name)},id:"modal-image-"+e.name}),s.default.createElement("label",{className:"custom-file-label",htmlFor:"modal-image-"+e.name},i.default.t("browse"))),f):s.default.createElement("img",{className:"btn-icon-right img-thumb",src:"data:"+e.type+";base64,"+t,alt:e.name})):!0===e["profile-write"]||this.state.add?"password"===e.type?s.default.createElement("div",null,s.default.createElement("input",{type:"password",className:"form-control"+c,id:"modal-edit-"+e.name,placeholder:e.placeholder?i.default.t(e.placeholder):"",onChange:function(t){return r.changeElt(t,e.name)},value:t||"",autoComplete:"new-password"}),s.default.createElement("input",{type:"password",className:"form-control"+c,id:"modal-edit-confirm"+e.name,placeholder:i.default.t(e.placeholderConfirm),value:this.state.listEltConfirm[e.name]||"",onChange:function(t){return r.changeEltConfirm(t,e.name)},autoComplete:"new-password"})):s.default.createElement("input",{type:e.type||"text",className:"form-control"+c,id:"modal-edit-"+e.name,placeholder:e.placeholder?i.default.t(e.placeholder):"",value:t,onChange:function(t){return r.changeElt(t,e.name)}}):s.default.createElement("input",{disabled:!0,type:e.type||"text",className:"form-control"+c,id:"modal-edit-"+e.name,placeholder:e.placeholder?i.default.t(e.placeholder):"",value:t})}return s.default.createElement("div",{className:"form-group",key:a},l,n,s.default.createElement("div",null,o),d)}},{key:"render",value:function(){var e=this,t=[];return this.state.pattern&&this.state.profile&&this.state.pattern.forEach((function(a,l){var n=e.editElt(a,e.state.profile[a.name],l);n&&t.push(n)})),s.default.createElement("div",null,s.default.createElement("div",{className:"row"},s.default.createElement("div",{className:"col-md-12"},s.default.createElement("h4",null,i.default.t("profile.hello",{name:this.state.profile.name||this.state.profile.username})))),s.default.createElement("div",{className:"row"},s.default.createElement("div",{className:"col-md-12"},s.default.createElement("form",{className:"needs-validation",noValidate:!0},t))),s.default.createElement("div",{className:"row"},s.default.createElement("div",{className:"col-md-12 text-right"},s.default.createElement("button",{type:"button",className:"btn btn-primary",onClick:function(t){return e.saveProfile(t)},disabled:!this.state.profile},i.default.t("profile.save")))))}}]),u);function u(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u);var t=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(u.__proto__||Object.getPrototypeOf(u)).call(this,e));return t.state={pattern:e.pattern,profile:e.profile,listAddValue:t.initListAdd(e.pattern),listEltConfirm:t.initListConfirm(e.pattern),listError:{}},t.editElt=t.editElt.bind(t),t.createData=t.createData.bind(t),t.initListAdd=t.initListAdd.bind(t),t.initListConfirm=t.initListConfirm.bind(t),t.deleteListElt=t.deleteListElt.bind(t),t.changeElt=t.changeElt.bind(t),t.toggleBooleanElt=t.toggleBooleanElt.bind(t),t.changeListAddElt=t.changeListAddElt.bind(t),t.AddListElt=t.AddListElt.bind(t),t.changeEltConfirm=t.changeEltConfirm.bind(t),t.changeTextArea=t.changeTextArea.bind(t),t.uploadFile=t.uploadFile.bind(t),t.uploadImage=t.uploadImage.bind(t),t.removeImage=t.removeImage.bind(t),t.editElt=t.editElt.bind(t),t.saveProfile=t.saveProfile.bind(t),t}t.default=d},74:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});function l(e,t){for(var a=0;a<t.length;a++){var l=t[a];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(e,l.key,l)}}var n=a(0),s=c(n),i=c(a(1)),r=c(a(3)),o=c(a(2));function c(e){return e&&e.__esModule?e:{default:e}}c(a(6));var d=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(u,n.Component),function(e,t,a){t&&l(e.prototype,t),a&&l(e,a)}(u,[{key:"componentWillReceiveProps",value:function(e){var t=this;this.setState({config:e.config,profile:e.profile,loggedIn:e.loggedIn},(function(){t.state.profile&&t.fetchLists()}))}},{key:"fetchLists",value:function(){var e=this;this.state.loggedIn&&(r.default.glewlwydRequest("/profile/session").then((function(t){e.setState({sessionList:t})})).fail((function(){o.default.sendMessage("Notification",{type:"danger",message:i.default.t("error-api-connect")})})),r.default.glewlwydRequest("/profile/plugin").then((function(t){t.forEach((function(t){"oauth2-glewlwyd"===t.module?r.default.glewlwydRequestSub("/"+t.name+"/profile/token"+(e.state.config.params.delegate?"?impersonate="+e.state.config.params.delegate:"")).then((function(a){var l=e.state.plugins;l.oauth2[t.name]=a,e.setState({plugins:l})})).fail((function(e){})):"oidc"===t.module&&r.default.glewlwydRequestSub("/"+t.name+"/token"+(e.state.config.params.delegate?"?impersonate="+e.state.config.params.delegate:"")).then((function(a){var l=e.state.plugins;l.oidc[t.name]=a,e.setState({plugins:l})})).fail((function(e){}))}))})).fail((function(){o.default.sendMessage("Notification",{type:"danger",message:i.default.t("error-api-connect")})})))}},{key:"getTable",value:function(e,t){return s.default.createElement("table",{className:"table table-responsive table-striped"},s.default.createElement("thead",null,e),s.default.createElement("tbody",null,t))}},{key:"disableSession",value:function(e){var t=this;this.setState({disableObject:e},(function(){o.default.sendMessage("App",{type:"confirm",title:i.default.t("profile.session-disable-title"),message:i.default.t("profile.session-disable-message"),callback:t.disableSessionConfirm})}))}},{key:"disableSessionConfirm",value:function(){var e=this;this.state.disableObject&&r.default.glewlwydRequest("/profile/session/"+this.state.disableObject.session_hash,"DELETE").then((function(e){o.default.sendMessage("Notification",{type:"info",message:i.default.t("profile.session-disabled")})})).fail((function(){o.default.sendMessage("Notification",{type:"danger",message:i.default.t("error-api-connect")})})).always((function(){e.fetchLists(),e.setState({disableObject:!1}),o.default.sendMessage("App",{type:"closeConfirm"})}))}},{key:"disableToken",value:function(e,t,a){var l=this;this.setState({disableObject:{type:e,key:t,token:a}},(function(){o.default.sendMessage("App",{type:"confirm",title:i.default.t("profile.session-disable-token-title"),message:i.default.t("profile.session-disable-token-message"),callback:l.disableTokenConfirm})}))}},{key:"disableTokenConfirm",value:function(){var e=this;this.state.disableObject&&("oauth2"===this.state.disableObject.type?r.default.glewlwydRequestSub("/"+this.state.disableObject.key+"/profile/token/"+this.state.disableObject.token.token_hash+(this.state.config.params.delegate?"?impersonate="+this.state.config.params.delegate:""),"DELETE").then((function(e){o.default.sendMessage("Notification",{type:"info",message:i.default.t("profile.token-disabled")})})).fail((function(){o.default.sendMessage("Notification",{type:"danger",message:i.default.t("error-api-connect")})})).always((function(){e.fetchLists(),e.setState({disableObject:!1}),o.default.sendMessage("App",{type:"closeConfirm"})})):"oidc"===this.state.disableObject.type&&r.default.glewlwydRequestSub("/"+this.state.disableObject.key+"/token/"+this.state.disableObject.token.token_hash+(this.state.config.params.delegate?"?impersonate="+this.state.config.params.delegate:""),"DELETE").then((function(e){o.default.sendMessage("Notification",{type:"info",message:i.default.t("profile.token-disabled")})})).fail((function(){o.default.sendMessage("Notification",{type:"danger",message:i.default.t("error-api-connect")})})).always((function(){e.fetchLists(),e.setState({disableObject:!1}),o.default.sendMessage("App",{type:"closeConfirm"})})))}},{key:"render",value:function(){var e=this,t=s.default.createElement("tr",null,s.default.createElement("th",null,i.default.t("profile.session-table-last-login")),s.default.createElement("th",null,i.default.t("profile.session-table-exiration")),s.default.createElement("th",null,i.default.t("profile.session-table-issued-for")),s.default.createElement("th",null,i.default.t("profile.session-table-user-agent")),s.default.createElement("th",null,i.default.t("admin.enabled")),s.default.createElement("th",null)),a=[],l=[];this.state.sessionList.forEach((function(t,l){var n=new Date(1e3*t.last_login),r=new Date(1e3*t.expiration);a.push(s.default.createElement("tr",{key:l},s.default.createElement("td",null,n.toLocaleString()),s.default.createElement("td",null,r.toLocaleString()),s.default.createElement("td",null,t.issued_for),s.default.createElement("td",null,t.user_agent),s.default.createElement("td",null,t.enabled?i.default.t("profile.session-enabled-true"):i.default.t("profile.session-enabled-false")),s.default.createElement("td",null,s.default.createElement("button",{type:"button",className:"btn btn-secondary",onClick:function(a){return e.disableSession(t)},title:i.default.t("admin.delete"),disabled:!t.enabled},s.default.createElement("i",{className:"fas fa-trash"})))))}));var n=0;for(var r in l=[],this.state.plugins.oauth2){var o=this.state.plugins.oauth2[r],c=s.default.createElement("tr",null,s.default.createElement("th",null,i.default.t("profile.session-table-last-login")),s.default.createElement("th",null,i.default.t("profile.session-table-exiration")),s.default.createElement("th",null,i.default.t("profile.session-table-client")),s.default.createElement("th",null,i.default.t("profile.session-table-issued-for")),s.default.createElement("th",null,i.default.t("profile.session-table-user-agent")),s.default.createElement("th",null,i.default.t("admin.enabled")),s.default.createElement("th",null)),d=[];o.forEach((function(t,a){var l=new Date(1e3*t.last_seen),n=new Date(1e3*t.expires_at);d.push(s.default.createElement("tr",{key:a},s.default.createElement("td",null,l.toLocaleString()),s.default.createElement("td",null,n.toLocaleString()),s.default.createElement("td",null,t.client_id),s.default.createElement("td",null,t.issued_for),s.default.createElement("td",null,t.user_agent),s.default.createElement("td",null,t.enabled?i.default.t("profile.session-enabled-true"):i.default.t("profile.session-enabled-false")),s.default.createElement("td",null,s.default.createElement("button",{type:"button",className:"btn btn-secondary",onClick:function(a){return e.disableToken("oauth2",r,t)},title:i.default.t("admin.delete"),disabled:!t.enabled},s.default.createElement("i",{className:"fas fa-trash"})))))})),l.push(s.default.createElement("div",{className:"card",key:++n},s.default.createElement("div",{className:"card-header",id:"dataFormatCard"},s.default.createElement("h2",{className:"mb-0"},s.default.createElement("button",{className:"btn btn-link",type:"button","data-toggle":"collapse","data-target":"#collapseOauth2-"+r,"aria-expanded":"true","aria-controls":"collapseOauth2-"+r},i.default.t("profile.session-token-oauth2-table",{name:r})))),s.default.createElement("div",{id:"collapseOauth2-"+r,className:"collapse","aria-labelledby":"dataFormatCard","data-parent":"#accordionParams"},s.default.createElement("div",{className:"card-body"},this.getTable(c,d)))))}for(var r in n=l.length,this.state.plugins.oidc){var u=this.state.plugins.oidc[r],f=s.default.createElement("tr",null,s.default.createElement("th",null,i.default.t("profile.session-table-last-login")),s.default.createElement("th",null,i.default.t("profile.session-table-exiration")),s.default.createElement("th",null,i.default.t("profile.session-table-client")),s.default.createElement("th",null,i.default.t("profile.session-table-issued-for")),s.default.createElement("th",null,i.default.t("profile.session-table-user-agent")),s.default.createElement("th",null,i.default.t("admin.enabled")),s.default.createElement("th",null));d=[],u.forEach((function(t,a){var l=new Date(1e3*t.last_seen),n=new Date(1e3*t.expires_at);d.push(s.default.createElement("tr",{key:a},s.default.createElement("td",null,l.toLocaleString()),s.default.createElement("td",null,n.toLocaleString()),s.default.createElement("td",null,t.client_id),s.default.createElement("td",null,t.issued_for),s.default.createElement("td",null,t.user_agent),s.default.createElement("td",null,t.enabled?i.default.t("profile.session-enabled-true"):i.default.t("profile.session-enabled-false")),s.default.createElement("td",null,s.default.createElement("button",{type:"button",className:"btn btn-secondary",onClick:function(a){return e.disableToken("oidc",r,t)},title:i.default.t("admin.delete"),disabled:!t.enabled},s.default.createElement("i",{className:"fas fa-trash"})))))})),l.push(s.default.createElement("div",{className:"card",key:++n},s.default.createElement("div",{className:"card-header",id:"dataFormatCard"},s.default.createElement("h2",{className:"mb-0"},s.default.createElement("button",{className:"btn btn-link",type:"button","data-toggle":"collapse","data-target":"#collapseOauth2-"+r,"aria-expanded":"true","aria-controls":"collapseOauth2-"+r},i.default.t("profile.session-token-oidc-table",{name:r})))),s.default.createElement("div",{id:"collapseOauth2-"+r,className:"collapse","aria-labelledby":"dataFormatCard","data-parent":"#accordionParams"},s.default.createElement("div",{className:"card-body"},this.getTable(f,d)))))}return s.default.createElement("div",null,s.default.createElement("div",{className:"row"},s.default.createElement("div",{className:"col-md-12"},s.default.createElement("h4",null,i.default.t("profile.session-title")))),s.default.createElement("div",{className:"row"},s.default.createElement("div",{className:"col-md-12"},s.default.createElement("div",{className:"accordion",id:"accordionParams"},s.default.createElement("div",{className:"card"},s.default.createElement("div",{className:"card-header",id:"dataFormatCard"},s.default.createElement("h2",{className:"mb-0"},s.default.createElement("button",{className:"btn btn-link",type:"button","data-toggle":"collapse","data-target":"#collapseSession","aria-expanded":"true","aria-controls":"collapseSession"},i.default.t("profile.session-table")))),s.default.createElement("div",{id:"collapseSession",className:"collapse","aria-labelledby":"dataFormatCard","data-parent":"#accordionParams"},s.default.createElement("div",{className:"card-body"},this.getTable(t,a)))),l))))}}]),u);function u(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u);var t=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(u.__proto__||Object.getPrototypeOf(u)).call(this,e));return t.state={config:e.config,profile:e.profile,loggedIn:e.loggedIn,sessionList:[],plugins:{oauth2:{},oidc:{}},disableObject:!1},t.fetchLists=t.fetchLists.bind(t),t.getTable=t.getTable.bind(t),t.disableSession=t.disableSession.bind(t),t.disableSessionConfirm=t.disableSessionConfirm.bind(t),t.disableToken=t.disableToken.bind(t),t.disableTokenConfirm=t.disableTokenConfirm.bind(t),t.state.profile&&t.fetchLists(),t}t.default=d},75:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});function l(e,t){for(var a=0;a<t.length;a++){var l=t[a];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(e,l.key,l)}}var n=a(0),s=r(n),i=r(a(1));function r(e){return e&&e.__esModule?e:{default:e}}r(a(3));var o=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(c,n.Component),function(e,t,a){t&&l(e.prototype,t),a&&l(e,a)}(c,[{key:"componentWillReceiveProps",value:function(e){this.setState({profile:e.profile})}},{key:"render",value:function(){return s.default.createElement("div",null,s.default.createElement("div",{className:"row"},s.default.createElement("div",{className:"col-md-12"},s.default.createElement("h4",null,i.default.t("profile.hello-delegate",{name:this.state.profile.name||this.state.profile.username})))))}}]),c);function c(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c);var t=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(c.__proto__||Object.getPrototypeOf(c)).call(this,e));return t.state={profile:e.profile},t}t.default=o},76:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});function l(e,t){for(var a=0;a<t.length;a++){var l=t[a];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(e,l.key,l)}}var n=a(0),s=c(n),i=c(a(1)),r=c(a(3)),o=c(a(2));function c(e){return e&&e.__esModule?e:{default:e}}c(a(6));var d=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(u,n.Component),function(e,t,a){t&&l(e.prototype,t),a&&l(e,a)}(u,[{key:"componentWillReceiveProps",value:function(e){this.setState({config:e.config,passwordMinLength:e.config.PasswordMinLength||8,callback:e.callback,old_password:"",password:"",password_confirm:"",oldPasswordInvalid:!1,passwordInvalid:!1,passwordConfirmInvalid:!1})}},{key:"closeModal",value:function(e,t){var a=this;t?this.checkPassword()&&r.default.glewlwydRequest("/profile/password","PUT",{old_password:this.state.old_password,password:this.state.password}).then((function(){a.setState({oldPasswordInvalid:!1},(function(){a.state.callback(t)}))})).fail((function(e){400==e.status?a.setState({oldPasswordInvalid:!0,oldPasswordInvalidMessage:i.default.t("profile.password-invalid")}):o.default.sendMessage("Notification",{type:"danger",message:i.default.t("error-api-connect")})})):this.state.callback(t)}},{key:"changeOldPassword",value:function(e){this.setState({old_password:e.target.value})}},{key:"changeNewPassword",value:function(e){this.setState({password:e.target.value})}},{key:"changeNewPasswordConfirm",value:function(e){this.setState({password_confirm:e.target.value})}},{key:"checkPassword",value:function(){var e=!1,t=!1,a="",l="";return this.state.password.length<this.state.passwordMinLength&&(e=!0,a=i.default.t("profile.password-min-characters",{minLength:this.state.passwordMinLength})),this.state.password!==this.state.password_confirm&&(t=!0,l=i.default.t("profile.password-not-match")),this.setState({passwordInvalid:e,passwordConfirmInvalid:t,passwordInvalidMessage:a,passwordConfirmInvalidMessage:l}),!e&&!t}},{key:"render",value:function(){var e=this;return s.default.createElement("div",{className:"modal fade",id:"passwordModal",tabIndex:"-1",role:"dialog","aria-labelledby":"confirmModalLabel","aria-hidden":"true"},s.default.createElement("div",{className:"modal-dialog modal-lg",role:"document"},s.default.createElement("div",{className:"modal-content"},s.default.createElement("div",{className:"modal-header"},s.default.createElement("h5",{className:"modal-title",id:"confirmModalLabel"},i.default.t("profile.password-modal-title")),s.default.createElement("button",{type:"button",className:"close","aria-label":i.default.t("modal.close"),onClick:function(t){return e.closeModal(t,!1)}},s.default.createElement("span",{"aria-hidden":"true"},"×"))),s.default.createElement("div",{className:"modal-body"},s.default.createElement("form",{className:"needs-validation",noValidate:!0},s.default.createElement("div",{className:"form-group"},s.default.createElement("div",{className:"input-group mb-3"},s.default.createElement("div",{className:"input-group-prepend"},s.default.createElement("label",{className:"input-group-text",htmlFor:"mod-old-password"},i.default.t("profile.password-modal-old-password"))),s.default.createElement("input",{type:"password",autoComplete:"current-password",className:"form-control"+(this.state.oldPasswordInvalid?" is-invalid":""),id:"oldPassword",placeholder:i.default.t("profile.password-modal-old-password-ph"),value:this.state.old_password,onChange:function(t){return e.changeOldPassword(t)}})),s.default.createElement("span",{className:"error-input"+(this.state.oldPasswordInvalid?"":" hidden")},this.state.oldPasswordInvalidMessage)),s.default.createElement("div",{className:"form-group"},s.default.createElement("div",{className:"input-group mb-3"},s.default.createElement("div",{className:"input-group-prepend"},s.default.createElement("label",{className:"input-group-text",htmlFor:"mod-new-password"},i.default.t("profile.password-modal-new-password"))),s.default.createElement("input",{type:"password",autoComplete:"new-password",className:"form-control"+(this.state.passwordInvalid?" is-invalid":""),id:"newPassword",placeholder:i.default.t("profile.password-modal-new-password-ph",{minLength:this.state.passwordMinLength}),value:this.state.password,onChange:function(t){return e.changeNewPassword(t)}})),s.default.createElement("span",{className:"error-input"+(this.state.passwordInvalid?"":" hidden")},this.state.passwordInvalidMessage)),s.default.createElement("div",{className:"form-group"},s.default.createElement("div",{className:"input-group mb-3"},s.default.createElement("div",{className:"input-group-prepend"},s.default.createElement("label",{className:"input-group-text",htmlFor:"mod-new-password-confirm"},i.default.t("profile.password-modal-new-password-confirm"))),s.default.createElement("input",{type:"password",autoComplete:"new-password",className:"form-control"+(this.state.passwordConfirmInvalid?" is-invalid":""),id:"retypeNewPassword",placeholder:i.default.t("profile.password-modal-new-password-confirm-ph",{minLength:this.state.passwordMinLength}),value:this.state.password_confirm,onChange:function(t){return e.changeNewPasswordConfirm(t)}})),s.default.createElement("span",{className:"error-input"+(this.state.passwordConfirmInvalid?"":" hidden")},this.state.passwordConfirmInvalidMessage)))),s.default.createElement("div",{className:"modal-footer"},s.default.createElement("button",{type:"button",className:"btn btn-secondary",onClick:function(t){return e.closeModal(t,!1)}},i.default.t("modal.close")),s.default.createElement("button",{type:"button",className:"btn btn-primary",onClick:function(t){return e.closeModal(t,!0)}},i.default.t("modal.ok"))))))}}]),u);function u(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u);var t=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(u.__proto__||Object.getPrototypeOf(u)).call(this,e));return t.state={config:e.config,passwordMinLength:e.config.PasswordMinLength||8,callback:e.callback,old_password:"",password:"",password_confirm:"",oldPasswordInvalid:!1,passwordInvalid:!1,passwordConfirmInvalid:!1},t.closeModal=t.closeModal.bind(t),t.changeOldPassword=t.changeOldPassword.bind(t),t.changeNewPassword=t.changeNewPassword.bind(t),t.changeNewPasswordConfirm=t.changeNewPasswordConfirm.bind(t),t.checkPassword=t.checkPassword.bind(t),t}t.default=d},77:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});function l(e,t){for(var a=0;a<t.length;a++){var l=t[a];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(e,l.key,l)}}var n=a(0),s=u(n),i=u(a(1)),r=u(a(78)),o=u(a(79)),c=u(a(80)),d=u(a(82));function u(e){return e&&e.__esModule?e:{default:e}}var f=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(m,n.Component),function(e,t,a){t&&l(e.prototype,t),a&&l(e,a)}(m,[{key:"componentWillReceiveProps",value:function(e){this.setState({config:e.config,module:e.module,name:e.name,profile:e.profile})}},{key:"render",value:function(){return"mock"===this.state.module?s.default.createElement(r.default,{config:this.state.config,module:this.state.module,name:this.state.name,profile:this.state.profile}):"webauthn"===this.state.module?s.default.createElement(o.default,{config:this.state.config,module:this.state.module,name:this.state.name,profile:this.state.profile}):"otp"===this.state.module?s.default.createElement(c.default,{config:this.state.config,module:this.state.module,name:this.state.name,profile:this.state.profile}):"certificate"===this.state.module?s.default.createElement(d.default,{config:this.state.config,module:this.state.module,name:this.state.name,profile:this.state.profile}):s.default.createElement("div",null,s.default.createElement("h4",null,i.default.t("profile.scheme-not-found",{module:this.state.module})))}}]),m);function m(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,m);var t=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(m.__proto__||Object.getPrototypeOf(m)).call(this,e));return t.state={config:e.config,module:e.module,name:e.name,profile:e.profile},t}t.default=f},78:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});function l(e,t){for(var a=0;a<t.length;a++){var l=t[a];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(e,l.key,l)}}var n=a(0),s=c(n),i=c(a(1)),r=c(a(3)),o=c(a(2));function c(e){return e&&e.__esModule?e:{default:e}}c(a(6));var d=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(u,n.Component),function(e,t,a){t&&l(e.prototype,t),a&&l(e,a)}(u,[{key:"componentWillReceiveProps",value:function(e){var t=this;this.setState({config:e.config,module:e.module,name:e.name,profile:e.profile,registered:!1,registration:!1},(function(){t.getRegister()}))}},{key:"getRegister",value:function(){var e=this;this.state.profile&&r.default.glewlwydRequest("/profile/scheme/register/","PUT",{username:this.state.profile.username,scheme_type:this.state.module,scheme_name:this.state.name},!0).then((function(t){e.setState({registration:i.default.t("profile.scheme-mock-register-status-registered"),registered:!0})})).fail((function(t){400===t.status?e.setState({registration:i.default.t("profile.scheme-mock-register-status-not-registered"),registered:!1}):o.default.sendMessage("Notification",{type:"danger",message:i.default.t("error-api-connect")})}))}},{key:"register",value:function(){var e=this;r.default.glewlwydRequest("/profile/scheme/register/","POST",{username:this.state.profile.username,scheme_type:this.state.module,scheme_name:this.state.name,value:{register:!this.state.registered}}).fail((function(e){o.default.sendMessage("Notification",{type:"danger",message:i.default.t("error-api-connect")})})).always((function(){e.getRegister()}))}},{key:"render",value:function(){var e,t=this;return this.state.registration&&(e=s.default.createElement("div",null,s.default.createElement("h4",null,i.default.t("profile.scheme-mock-register-status")),s.default.createElement("span",{className:"badge badge-primary"},this.state.registration))),s.default.createElement("div",null,s.default.createElement("div",{className:"row"},s.default.createElement("div",{className:"col-md-12"},s.default.createElement("h4",null,i.default.t("profile.scheme-mock-title",{module:this.state.module,name:this.state.name})))),s.default.createElement("div",{className:"row"},s.default.createElement("div",{className:"col-md-12"},e)),s.default.createElement("div",{className:"row"},s.default.createElement("div",{className:"col-md-12"},s.default.createElement("hr",null))),s.default.createElement("div",{className:"row"},s.default.createElement("div",{className:"col-md-12"},s.default.createElement("div",{className:"btn-group",role:"group"},s.default.createElement("button",{type:"button",className:"btn btn-primary",onClick:function(e){return t.register(e)}},this.state.registered?i.default.t("profile.scheme-mock-deregister"):i.default.t("profile.scheme-mock-register"))))))}}]),u);function u(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u);var t=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(u.__proto__||Object.getPrototypeOf(u)).call(this,e));return t.state={config:e.config,module:e.module,name:e.name,profile:e.profile,registered:!1,registration:!1},t.getRegister=t.getRegister.bind(t),t.register=t.register.bind(t),t.getRegister(),t}t.default=d},79:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});function l(e,t){for(var a=0;a<t.length;a++){var l=t[a];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(e,l.key,l)}}var n=a(0),s=c(n),i=c(a(1)),r=c(a(3)),o=c(a(2));function c(e){return e&&e.__esModule?e:{default:e}}c(a(6));var d=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(u,n.Component),function(e,t,a){t&&l(e.prototype,t),a&&l(e,a)}(u,[{key:"componentWillReceiveProps",value:function(e){var t=this;this.setState({config:e.config,module:e.module,name:e.name,profile:e.profile,registered:!1,registration:!1},(function(){t.getCredentials()}))}},{key:"strToBin",value:function(e){return Uint8Array.from(atob(e),(function(e){return e.charCodeAt(0)}))}},{key:"binToStr",value:function(e){return btoa(new Uint8Array(e).reduce((function(e,t){return e+String.fromCharCode(t)}),""))}},{key:"getCredentials",value:function(){var e=this;this.state.profile&&r.default.glewlwydRequest("/profile/scheme/register/","PUT",{username:this.state.profile.username,scheme_type:this.state.module,scheme_name:this.state.name},!0).then((function(t){var a=!1;t.forEach((function(e){"registered"==e.status&&(a=!0)})),e.setState({credentialList:t,credentialAvailable:a,credAssertion:!1})})).fail((function(t){401===t.status?e.setState({registration:i.default.t("profile.scheme-webauthn-register-status-not-registered"),registered:!1,credentialList:[],credAssertion:!1}):o.default.sendMessage("Notification",{type:"danger",message:i.default.t("error-api-connect")})}))}},{key:"createCredential",value:function(){var e=this;r.default.glewlwydRequest("/profile/scheme/register/","POST",{username:this.state.profile.username,scheme_type:this.state.module,scheme_name:this.state.name,value:{register:"new-credential"}}).then((function(t){var a=[];e.state.credentialList.forEach((function(t){a.push({id:e.strToBin(t.credential_id),type:"public-key"})}));var l={authenticatorSelection:{requireResidentKey:!1},rp:{name:t.rpId.split("://")[1]},user:{id:Uint8Array.from(atob(t.user.id),(function(e){return e.charCodeAt(0)})),name:t.user.name,displayName:e.state.profile.name||t.user.name},pubKeyCredParams:t["pubKey-cred-params"],challenge:e.strToBin(t.challenge),excludeCredentials:a};t["attestation-required"]&&(l.attestation=t["attestation-required"]),t.timeout&&(l.timeout=t.timeout),navigator.credentials.create({publicKey:l}).then((function(a){var l={};"id"in a&&(l.id=a.id),"type"in a&&(l.type=a.type),"rawId"in a&&(l.rawId=e.binToStr(a.rawId));var n={};n.clientDataJSON=e.binToStr(a.response.clientDataJSON),n.attestationObject=e.binToStr(a.response.attestationObject),a.response.getTransports&&(n.transports=a.response.getTransports()),l.response=n,r.default.glewlwydRequest("/profile/scheme/register/","POST",{username:e.state.profile.username,scheme_type:e.state.module,scheme_name:e.state.name,value:{register:"register-credential",session:t.session,credential:l}}).then((function(){o.default.sendMessage("Notification",{type:"info",message:i.default.t("profile.scheme-webauthn-register-credential-success")}),e.getCredentials()})).fail((function(e,t){400===e.status?(o.default.sendMessage("Notification",{type:"danger",message:i.default.t("profile.scheme-webauthn-register-credential-error")}),o.default.sendMessage("App",{type:"message",title:i.default.t("profile.scheme-webauthn-register-credential-error"),message:e.responseJSON})):o.default.sendMessage("Notification",{type:"danger",message:i.default.t("error-api-connect")})}))})).catch((function(e){o.default.sendMessage("Notification",{type:"danger",message:i.default.t("profile.scheme-webauthn-error-registration")}),o.default.sendMessage("App",{type:"message",title:i.default.t("profile.scheme-webauthn-register-credential-error"),message:[e.toString()]})}))})).fail((function(e){o.default.sendMessage("Notification",{type:"danger",message:i.default.t("error-api-connect")})}))}},{key:"testAssertion",value:function(e){var t=this;r.default.glewlwydRequest("/profile/scheme/register/","POST",{username:this.state.profile.username,scheme_type:this.state.module,scheme_name:this.state.name,value:{register:"trigger-assertion"}}).then((function(e){var a=[];e.allowCredentials.forEach((function(e){a.push({id:t.strToBin(e.credential_id),type:"public-key"})}));var l={allowCredentials:a,challenge:t.strToBin(e.challenge)};navigator.credentials.get({publicKey:l}).then((function(a){var l={};"id"in a&&(l.id=a.id),"type"in a&&(l.type=a.type),"rawId"in a&&(l.rawId=t.binToStr(a.rawId)),t.setState({credAssertion:l.rawId}),l.response={clientDataJSON:t.binToStr(a.response.clientDataJSON),authenticatorData:t.binToStr(a.response.authenticatorData),signature:t.binToStr(a.response.signature),userHandle:t.binToStr(a.response.userHandle)},a.response.getTransports&&(response.transports=a.response.getTransports()),r.default.glewlwydRequest("/profile/scheme/register/","POST",{username:t.state.profile.username,scheme_type:t.state.module,scheme_name:t.state.name,value:{register:"validate-assertion",session:e.session,credential:l}},!0).then((function(){o.default.sendMessage("Notification",{type:"info",message:i.default.t("profile.scheme-webauthn-assertion-success")})})).fail((function(e){401===e.status?o.default.sendMessage("Notification",{type:"danger",message:i.default.t("profile.scheme-webauthn-assertion-error")}):o.default.sendMessage("Notification",{type:"danger",message:i.default.t("error-api-connect")})}))})).catch((function(e){o.default.sendMessage("Notification",{type:"danger",message:i.default.t("profile.scheme-webauthn-error-assertion")}),o.default.sendMessage("App",{type:"message",title:i.default.t("profile.scheme-webauthn-register-credential-error"),message:[e.toString()]})}))})).fail((function(e){o.default.sendMessage("Notification",{type:"danger",message:i.default.t("error-api-connect")})}))}},{key:"editNameCred",value:function(e){this.setState({editIndex:e,editValue:this.state.credentialList[e].name,credAssertion:!1})}},{key:"changeName",value:function(e){this.setState({editValue:e.target.value,credAssertion:!1})}},{key:"saveName",value:function(e,t){var a=this;e.preventDefault(),r.default.glewlwydRequest("/profile/scheme/register/","POST",{username:this.state.profile.username,scheme_type:this.state.module,scheme_name:this.state.name,value:{register:"edit-credential",credential_id:this.state.credentialList[t].credential_id,name:this.state.editValue}}).then((function(e){a.setState({editIndex:-1,editValue:""},(function(){a.getCredentials()}))})).fail((function(e){o.default.sendMessage("Notification",{type:"danger",message:i.default.t("error-api-connect")})}))}},{key:"cancelSaveName",value:function(){this.setState({editIndex:-1,editValue:""})}},{key:"switchCred",value:function(e){var t=this;r.default.glewlwydRequest("/profile/scheme/register/","POST",{username:this.state.profile.username,scheme_type:this.state.module,scheme_name:this.state.name,value:{register:"registered"===this.state.credentialList[e].status?"disable-credential":"enable-credential",credential_id:this.state.credentialList[e].credential_id}}).then((function(e){t.getCredentials()})).fail((function(e){o.default.sendMessage("Notification",{type:"danger",message:i.default.t("error-api-connect")})}))}},{key:"removeCred",value:function(e){var t=this;this.setState({removeIndex:e},(function(){o.default.sendMessage("App",{type:"confirm",title:i.default.t("profile.scheme-webauthn-confirm-title"),message:i.default.t("profile.scheme-webauthn-confirm-message"),callback:t.confirmRemoveCred})}))}},{key:"confirmRemoveCred",value:function(e){var t=this;e?r.default.glewlwydRequest("/profile/scheme/register/","POST",{username:this.state.profile.username,scheme_type:this.state.module,scheme_name:this.state.name,value:{register:"remove-credential",credential_id:this.state.credentialList[this.state.removeIndex].credential_id}}).then((function(e){t.getCredentials(),o.default.sendMessage("Notification",{type:"info",message:i.default.t("profile.scheme-webauthn-removed")})})).fail((function(e){o.default.sendMessage("Notification",{type:"danger",message:i.default.t("error-api-connect")})})).always((function(){o.default.sendMessage("App",{type:"closeConfirm"})})):o.default.sendMessage("App",{type:"closeConfirm"})}},{key:"render",value:function(){var e,t=this,a=[];return this.state.credentialList.forEach((function(e,l){var n=new Date(1e3*e.created_at);if(t.state.editIndex===l)a.push(s.default.createElement("tr",{key:l},s.default.createElement("td",{className:"d-none d-md-block"},n.toLocaleString()),s.default.createElement("td",null,s.default.createElement("form",{className:"needs-validation",noValidate:!0,onSubmit:function(e){return t.saveName(e,l)}},s.default.createElement("input",{type:"text",className:"form-control",value:t.state.editValue,onChange:function(e){return t.changeName(e,l)},placeholder:i.default.t("profile.webauthn-edit-placeholder")}))),s.default.createElement("td",{className:"d-none d-md-block"},i.default.t("admin.yes")),s.default.createElement("td",null,s.default.createElement("div",{className:"btn-group",role:"group"},s.default.createElement("button",{type:"button",className:"btn btn-primary",onClick:function(e){return t.saveName(e,l)},title:i.default.t("modal.ok")},s.default.createElement("i",{className:"fas fa-save"})),s.default.createElement("button",{type:"button",className:"btn btn-primary",onClick:function(e){return t.cancelSaveName()},title:i.default.t("modal.close")},s.default.createElement("i",{className:"fas fa-times"}))))));else if("registered"===e.status){var r="";e.credential_id===t.state.credAssertion&&(r=s.default.createElement("i",{className:"far fa-check-circle btn-icon-right text-success"})),a.push(s.default.createElement("tr",{key:l},s.default.createElement("td",{className:"d-none d-md-block"},n.toLocaleString()),s.default.createElement("td",null,s.default.createElement("span",{className:"badge badge-success"},e.name),r),s.default.createElement("td",{className:"d-none d-md-block"},i.default.t("admin.yes")),s.default.createElement("td",null,s.default.createElement("div",{className:"btn-group",role:"group"},s.default.createElement("button",{type:"button",className:"btn btn-primary",onClick:function(e){return t.switchCred(l)},title:i.default.t("profile.scheme-webauthn-btn-switch-off")},s.default.createElement("i",{className:"fas fa-toggle-on"})),s.default.createElement("button",{type:"button",className:"btn btn-primary",onClick:function(e){return t.editNameCred(l)},title:i.default.t("profile.scheme-webauthn-btn-edit")},s.default.createElement("i",{className:"fas fa-edit"})),s.default.createElement("button",{type:"button",className:"btn btn-primary",onClick:function(e){return t.removeCred(l)},title:i.default.t("profile.scheme-webauthn-btn-remove")},s.default.createElement("i",{className:"fas fa-trash"}))))))}else a.push(s.default.createElement("tr",{key:l},s.default.createElement("td",{className:"d-none d-md-block"},n.toLocaleString()),s.default.createElement("td",null,s.default.createElement("span",{className:"badge badge-danger"},e.name)),s.default.createElement("td",{className:"d-none d-md-block"},i.default.t("admin.no")),s.default.createElement("td",null,s.default.createElement("div",{className:"btn-group",role:"group"},s.default.createElement("button",{type:"button",className:"btn btn-primary",onClick:function(e){return t.switchCred(l)},title:i.default.t("profile.scheme-webauthn-btn-switch-on")},s.default.createElement("i",{className:"fas fa-toggle-off"})),s.default.createElement("button",{type:"button",className:"btn btn-primary",onClick:function(e){return t.editNameCred(l)},title:i.default.t("profile.scheme-webauthn-btn-edit")},s.default.createElement("i",{className:"fas fa-edit"})),s.default.createElement("button",{type:"button",className:"btn btn-primary",onClick:function(e){return t.removeCred(l)},title:i.default.t("profile.scheme-webauthn-btn-remove")},s.default.createElement("i",{className:"fas fa-trash"}))))))})),this.state.webauthnEnabled||(e=s.default.createElement("div",{className:"row"},s.default.createElement("div",{className:"col-md-12"},s.default.createElement("div",{className:"alert alert-danger",role:"alert"},i.default.t("profile.scheme-webauthn-disabled"))))),s.default.createElement("div",null,s.default.createElement("div",{className:"row"},s.default.createElement("div",{className:"col-md-12"},s.default.createElement("h4",null,i.default.t("profile.scheme-webauthn-title",{module:this.state.module,name:this.state.name})))),e,s.default.createElement("div",{className:"row"},s.default.createElement("div",{className:"col-md-12"},s.default.createElement("button",{type:"button",className:"btn btn-primary",onClick:function(e){return t.getCredentials(e)}},i.default.t("login.btn-reload")))),s.default.createElement("div",{className:"row"},s.default.createElement("div",{className:"col-md-12"},s.default.createElement("table",{className:"table table-responsive table-striped"},s.default.createElement("thead",null,s.default.createElement("tr",null,s.default.createElement("th",{className:"d-none d-md-block"},i.default.t("profile.scheme-webauthn-table-created_at")),s.default.createElement("th",null,i.default.t("profile.scheme-webauthn-table-name")),s.default.createElement("th",{className:"d-none d-md-block"},i.default.t("profile.scheme-webauthn-table-enabled")),s.default.createElement("th",null))),s.default.createElement("tbody",null,a)))),s.default.createElement("div",{className:"row"},s.default.createElement("div",{className:"col-md-12"},s.default.createElement("hr",null))),s.default.createElement("div",{className:"row"},s.default.createElement("div",{className:"col-md-12"},s.default.createElement("div",{className:"btn-group",role:"group"},s.default.createElement("button",{type:"button",disabled:!this.state.webauthnEnabled,className:"btn btn-primary",onClick:function(e){return t.createCredential(e)},title:i.default.t("profile.scheme-webauthn-register-title")},i.default.t("profile.scheme-webauthn-register")),s.default.createElement("button",{type:"button",className:"btn btn-primary",onClick:function(e){return t.testAssertion(e)},disabled:!this.state.credentialAvailable||!this.state.webauthnEnabled,title:i.default.t("profile.scheme-webauthn-test-registration-title")},i.default.t("profile.scheme-webauthn-test-registration"))))))}}]),u);function u(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u);var t=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(u.__proto__||Object.getPrototypeOf(u)).call(this,e));return t.state={config:e.config,module:e.module,name:e.name,profile:e.profile,registered:!1,registration:!1,credentialList:[],credentialAvailable:!1,editIndex:-1,editValue:"",removeIndex:-1,credAssertion:!1,webauthnEnabled:!!window.PublicKeyCredential},t.getCredentials=t.getCredentials.bind(t),t.createCredential=t.createCredential.bind(t),t.testAssertion=t.testAssertion.bind(t),t.editNameCred=t.editNameCred.bind(t),t.changeName=t.changeName.bind(t),t.saveName=t.saveName.bind(t),t.cancelSaveName=t.cancelSaveName.bind(t),t.switchCred=t.switchCred.bind(t),t.removeCred=t.removeCred.bind(t),t.confirmRemoveCred=t.confirmRemoveCred.bind(t),t.getCredentials(),t}t.default=d},80:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});function l(e,t){for(var a=0;a<t.length;a++){var l=t[a];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(e,l.key,l)}}var n=a(0),s=d(n),i=d(a(1)),r=d(a(81)),o=d(a(3)),c=d(a(2));function d(e){return e&&e.__esModule?e:{default:e}}d(a(6));var u=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(f,n.Component),function(e,t,a){t&&l(e.prototype,t),a&&l(e,a)}(f,[{key:"componentWillReceiveProps",value:function(e){var t=this;this.setState({config:e.config,module:e.module,name:e.name,profile:e.profile},(function(){t.getRegister()}))}},{key:"getRegister",value:function(){var e=this;this.state.profile&&o.default.glewlwydRequest("/profile/scheme/register/","PUT",{username:this.state.profile.username,scheme_type:this.state.module,scheme_name:this.state.name}).then((function(t){var a;a="NONE"!==t.type&&t.type?t:{type:"NONE",secret:"",moving_factor:0,time_step_size:t["totp-window"]},e.setState({myOtp:a,allowHotp:t["hotp-allow"],allowTotp:t["totp-allow"]})})).fail((function(e){c.default.sendMessage("Notification",{type:"danger",message:i.default.t("error-api-connect")})})).always((function(){e.showQRCode()}))}},{key:"showQRCode",value:function(){var e=!1;if(this.state.myOtp.issuer&&this.state.profile.username&&this.state.myOtp.secret&&this.state.myOtp.digits&&("HOTP"===this.state.myOtp.type&&void 0!==this.state.myOtp.moving_factor?e="otpauth://hotp/"+encodeURIComponent(this.state.myOtp.issuer)+":"+encodeURIComponent(this.state.profile.username)+"?issuer="+encodeURIComponent([location.protocol,"//",location.host].join(""))+"&secret="+encodeURIComponent(this.state.myOtp.secret)+"&digits="+this.state.myOtp.digits+"&algorithm=SHA1&counter="+this.state.myOtp.moving_factor:"TOTP"===this.state.myOtp.type&&this.state.myOtp.time_step_size&&(e="otpauth://totp/"+encodeURIComponent(this.state.myOtp.issuer)+":"+encodeURIComponent(this.state.profile.username)+"?issuer="+encodeURIComponent([location.protocol,"//",location.host].join(""))+"&secret="+encodeURIComponent(this.state.myOtp.secret)+"&digits="+this.state.myOtp.digits+"&algorithm=SHA1&period="+this.state.myOtp.time_step_size)),e){var t=(0,r.default)(0,"L");t.addData(e),t.make(),this.setState({otpUrl:e,qrcode:t.createSvgTag(4)})}else this.setState({otpUrl:!1,qrcode:""})}},{key:"changeParam",value:function(e,t,a){var l=this,n=this.state.myOtp;n[t]=a?parseInt(e.target.value):e.target.value,this.setState({myOtp:n},(function(){l.showQRCode()}))}},{key:"changeType",value:function(e,t){var a=this;e.preventDefault();var l=this.state.myOtp;l.type=t,this.setState({myOtp:l},(function(){a.showQRCode()}))}},{key:"generateSecret",value:function(){var e=this;o.default.glewlwydRequest("/profile/scheme/register/","POST",{username:this.state.profile.username,scheme_type:this.state.module,scheme_name:this.state.name,value:{"generate-secret":!0}}).then((function(t){var a=e.state.myOtp;a.secret=t.secret,e.setState({myOtp:a},(function(){e.showQRCode()}))})).fail((function(e){c.default.sendMessage("Notification",{type:"danger",message:i.default.t("error-api-connect")})}))}},{key:"register",value:function(){var e=this,t={},a=!1;"NONE"!==this.state.myOtp.type&&(this.state.myOtp.secret||(t.secret=i.default.t("profile.scheme-otp-secret-error"),a=!0),"HOTP"===this.state.myOtp.type?""!==this.state.myOtp.moving_factor&&void 0!==this.state.myOtp.moving_factor||(t.moving_factor=i.default.t("profile.scheme-otp-moving_factor-error"),a=!0):"TOTP"===this.state.myOtp.type&&(""!==this.state.myOtp.time_step_size&&void 0!==this.state.myOtp.time_step_size||(t.time_step_size=i.default.t("profile.scheme-otp-time_step_size-error"),a=!0),""===this.state.myOtp.start_offset&&(t.start_offset=i.default.t("profile.scheme-otp-start_offset-error"),a=!0))),this.setState({errorList:t},(function(){a||o.default.glewlwydRequest("/profile/scheme/register/","POST",{username:e.state.profile.username,scheme_type:e.state.module,scheme_name:e.state.name,value:e.state.myOtp}).then((function(t){c.default.sendMessage("Notification",{type:"info",message:i.default.t("profile.scheme-otp-save-ok")}),e.getRegister()})).fail((function(e){c.default.sendMessage("Notification",{type:"danger",message:i.default.t("profile.scheme-otp-save-error")})}))}))}},{key:"render",value:function(){var e,t,a,l,n,r,o=this;return a=s.default.createElement("div",{className:"row"},s.default.createElement("div",{className:"col-md-12"},s.default.createElement("div",{className:"input-group input-group-sm mb-3"},s.default.createElement("div",{className:"input-group-prepend"},s.default.createElement("span",{className:"input-group-text"},i.default.t("profile.scheme-otp-secret"))),s.default.createElement("input",{type:"text",maxLength:"128",className:this.state.errorList.secret?"form-control is-invalid":"form-control",id:"scheme-otp-secret",onChange:function(e){return o.changeParam(e,"secret")},value:this.state.myOtp.secret,placeholder:i.default.t("profile.scheme-otp-secret-ph")}),s.default.createElement("div",{className:"input-group-append"},s.default.createElement("button",{className:"btn btn-outline-secondary",type:"button",onClick:this.generateSecret},i.default.t("profile.scheme-otp-generate-secret"))),this.state.errorList.secret?s.default.createElement("span",{className:"error-input"},this.state.errorList.secret):""))),"HOTP"===this.state.myOtp.type?e=s.default.createElement("div",null,a,s.default.createElement("div",{className:"row"},s.default.createElement("div",{className:"col-md-12"},s.default.createElement("div",{className:"input-group input-group-sm mb-3"},s.default.createElement("div",{className:"input-group-prepend"},s.default.createElement("span",{className:"input-group-text"},i.default.t("profile.scheme-otp-moving_factor"))),s.default.createElement("input",{type:"number",min:"0",step:"1",className:this.state.errorList.moving_factor?"form-control is-invalid":"form-control",id:"scheme-otp-moving_factor",onChange:function(e){return o.changeParam(e,"moving_factor",1)},value:this.state.myOtp.moving_factor,placeholder:i.default.t("profile.scheme-otp-moving_factor-ph")}),this.state.errorList.moving_factor?s.default.createElement("span",{className:"error-input"},this.state.errorList.moving_factor):"")))):"TOTP"===this.state.myOtp.type&&(t=s.default.createElement("div",null,a,s.default.createElement("div",{className:"row"},s.default.createElement("div",{className:"col-md-12"},s.default.createElement("div",{className:"input-group input-group-sm mb-3"},s.default.createElement("div",{className:"input-group-prepend"},s.default.createElement("span",{className:"input-group-text"},i.default.t("profile.scheme-otp-time_step_size"))),s.default.createElement("input",{type:"number",min:"0",step:"1",className:this.state.errorList.time_step_size?"form-control is-invalid":"form-control",id:"scheme-otp-time_step_size",onChange:function(e){return o.changeParam(e,"time_step_size",1)},value:this.state.myOtp.time_step_size,placeholder:i.default.t("profile.scheme-otp-time_step_size-ph")}),this.state.errorList.time_step_size?s.default.createElement("span",{className:"error-input"},this.state.errorList.time_step_size):""))))),this.state.allowHotp&&(l=s.default.createElement("a",{className:"dropdown-item"+("HOTP"===this.state.myOtp.type?" active":""),href:"#",onClick:function(e){return o.changeType(e,"HOTP")}},i.default.t("profile.scheme-otp-type-HOTP"))),this.state.allowTotp&&(n=s.default.createElement("a",{className:"dropdown-item"+("TOTP"===this.state.myOtp.type?" active":""),href:"#",onClick:function(e){return o.changeType(e,"TOTP")}},i.default.t("profile.scheme-otp-type-TOTP"))),this.state.otpUrl&&(r=s.default.createElement("div",{className:"row"},s.default.createElement("div",{className:"col-md-4"},s.default.createElement("a",{href:this.state.otpUrl,title:this.state.otpUrl},s.default.createElement("div",{dangerouslySetInnerHTML:{__html:this.state.qrcode}}))))),s.default.createElement("div",null,s.default.createElement("div",{className:"row"},s.default.createElement("div",{className:"col-md-12"},s.default.createElement("h4",null,i.default.t("profile.scheme-otp-title")))),s.default.createElement("div",{className:"row"},s.default.createElement("div",{className:"col-md-12"},s.default.createElement("div",{className:"input-group input-group-sm mb-3"},s.default.createElement("div",{className:"input-group-prepend"},s.default.createElement("span",{className:"input-group-text"},i.default.t("profile.scheme-otp-type"))),s.default.createElement("div",{className:"dropdown"},s.default.createElement("button",{className:"btn btn-secondary dropdown-toggle",type:"button",id:"scheme-otp-type","data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false"},i.default.t("profile.scheme-otp-type-"+this.state.myOtp.type)),s.default.createElement("div",{className:"dropdown-menu","aria-labelledby":"scheme-otp-type"},n,l,s.default.createElement("a",{className:"dropdown-item"+("NONE"===this.state.myOtp.type?" active":""),href:"#",onClick:function(e){return o.changeType(e,"NONE")}},i.default.t("profile.scheme-otp-type-NONE"))))))),e,t,r,s.default.createElement("div",{className:"row"},s.default.createElement("div",{className:"col-md-12"},s.default.createElement("hr",null))),s.default.createElement("div",{className:"row"},s.default.createElement("div",{className:"col-md-12"},s.default.createElement("div",{className:"btn-group",role:"group"},s.default.createElement("button",{type:"button",className:"btn btn-primary",onClick:function(e){return o.register(e)}},i.default.t("profile.scheme-otp-save"))))))}}]),f);function f(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,f);var t=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(f.__proto__||Object.getPrototypeOf(f)).call(this,e));return t.state={config:e.config,module:e.module,name:e.name,profile:e.profile,myOtp:!1,errorList:{},otpUrl:!1,qrcode:"",allowHotp:!1,allowTotp:!1},t.getRegister=t.getRegister.bind(t),t.register=t.register.bind(t),t.changeParam=t.changeParam.bind(t),t.changeType=t.changeType.bind(t),t.generateSecret=t.generateSecret.bind(t),t.showQRCode=t.showQRCode.bind(t),t.getRegister(),t}t.default=u},82:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});function l(e,t){for(var a=0;a<t.length;a++){var l=t[a];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(e,l.key,l)}}var n=a(0),s=c(n),i=c(a(1)),r=c(a(3)),o=c(a(2));function c(e){return e&&e.__esModule?e:{default:e}}c(a(6));var d=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(u,n.Component),function(e,t,a){t&&l(e.prototype,t),a&&l(e,a)}(u,[{key:"componentWillReceiveProps",value:function(e){this.setState({config:e.config,module:e.module,name:e.name,profile:e.profile,registered:!1,registration:!1,addModal:!1,certFile:!1,fileName:!1,activeCert:!1,downloadCert:!1,showPassword:!1,canAddCert:!1,canRequestCert:!1})}},{key:"getRegister",value:function(){var e=this;return this.state.profile?r.default.glewlwydRequest("/profile/scheme/register/","PUT",{username:this.state.profile.username,scheme_type:this.state.module,scheme_name:this.state.name}).then((function(t){e.setState({certificateList:t.certificate,canAddCert:t["add-certificate"],certFile:!1,canRequestCert:t["request-certificate"],fileName:!1,activeCert:!1,downloadCert:!1})})).fail((function(t){e.setState({certificateList:[],canAddCert:!1,canRequestCert:!1,certFile:!1,fileName:!1,downloadCert:!1},(function(){o.default.sendMessage("Notification",{type:"danger",message:i.default.t("error-api-connect")})}))})):Promise.reject(new Error("fail"))}},{key:"selectCertFile",value:function(e){var t=this,a=(this.state.profile,e.target.files[0]),l=new FileReader;l.onload=function(e){t.setState({certFile:e.target.result,fileName:a.name})},l.readAsText(a)}},{key:"addCertificateFile",value:function(){var e=this;this.state.certFile&&r.default.glewlwydRequest("/profile/scheme/register/","POST",{username:this.state.profile.username,scheme_type:this.state.module,scheme_name:this.state.name,value:{register:"upload-certificate",x509:this.state.certFile}}).then((function(t){e.getRegister()})).fail((function(e){400===e.status?o.default.sendMessage("Notification",{type:"danger",message:i.default.t("profile.scheme-certificate-invalid")}):o.default.sendMessage("Notification",{type:"danger",message:i.default.t("error-api-connect")})}))}},{key:"addCertificateFromRequest",value:function(){var e=this;r.default.glewlwydRequest("/profile/scheme/register/","POST",{username:this.state.profile.username,scheme_type:this.state.module,scheme_name:this.state.name,value:{register:"use-certificate"}}).then((function(t){e.getRegister()})).fail((function(e){400===e.status?o.default.sendMessage("Notification",{type:"danger",message:i.default.t("profile.scheme-certificate-invalid")}):o.default.sendMessage("Notification",{type:"danger",message:i.default.t("error-api-connect")})}))}},{key:"requestNewCertificate",value:function(){var e=this;r.default.glewlwydRequest("/profile/scheme/register/","POST",{username:this.state.profile.username,scheme_type:this.state.module,scheme_name:this.state.name,value:{register:"request-certificate"}}).then((function(t){e.getRegister().then((function(){e.setState({downloadCert:t,showPassword:!1})}))})).fail((function(e){400===e.status?o.default.sendMessage("Notification",{type:"danger",message:i.default.t("profile.scheme-certificate-invalid")}):o.default.sendMessage("Notification",{type:"danger",message:i.default.t("error-api-connect")})}))}},{key:"switchCertStatus",value:function(e){var t=this;r.default.glewlwydRequest("/profile/scheme/register/","POST",{username:this.state.profile.username,scheme_type:this.state.module,scheme_name:this.state.name,value:{register:"toggle-certificate",certificate_id:e.certificate_id,enabled:!e.enabled}}).then((function(a){o.default.sendMessage("Notification",{type:"info",message:i.default.t("profile.scheme-certificate-"+(e.enabled?"disabled":"enabled"))}),t.getRegister()})).fail((function(e){o.default.sendMessage("Notification",{type:"danger",message:i.default.t("error-api-connect")})}))}},{key:"deleteCert",value:function(e,t){var a=this;e.preventDefault(),this.setState({curCert:t,certFile:!1,fileName:!1},(function(){o.default.sendMessage("App",{type:"confirm",title:i.default.t("profile.scheme-certificate-confirm-title"),message:i.default.t("profile.scheme-certificate-confirm-message"),callback:a.confirmDeleteCert})}))}},{key:"confirmDeleteCert",value:function(e){var t=this;e?r.default.glewlwydRequest("/profile/scheme/register/","POST",{username:this.state.profile.username,scheme_type:this.state.module,scheme_name:this.state.name,value:{register:"delete-certificate",certificate_id:this.state.curCert.certificate_id}}).then((function(e){t.getRegister()})).fail((function(e){o.default.sendMessage("Notification",{type:"danger",message:i.default.t("error-api-connect")})})).always((function(){o.default.sendMessage("App",{type:"closeConfirm"})})):o.default.sendMessage("App",{type:"closeConfirm"})}},{key:"testCertificate",value:function(){var e=this;r.default.glewlwydRequest("/profile/scheme/register/","POST",{username:this.state.profile.username,scheme_type:this.state.module,scheme_name:this.state.name,value:{register:"test-certificate"}}).then((function(t){e.setState({activeCert:t}),o.default.sendMessage("Notification",{type:"info",message:i.default.t("profile.scheme-certificate-test-valid")})})).fail((function(e){400===e.status||401===e.status?o.default.sendMessage("Notification",{type:"danger",message:i.default.t("profile.scheme-certificate-invalid")}):o.default.sendMessage("Notification",{type:"danger",message:i.default.t("error-api-connect")})}))}},{key:"showPassword",value:function(){this.setState({showPassword:!this.state.showPassword})}},{key:"copyPassword",value:function(){navigator.clipboard.writeText(this.state.downloadCert.password).then((function(){o.default.sendMessage("Notification",{type:"info",message:i.default.t("profile.scheme-certificate-p12-file-copy-password-success")})}),(function(e){o.default.sendMessage("Notification",{type:"danger",message:i.default.t("profile.scheme-certificate-p12-file-copy-password-error")})}))}},{key:"render",value:function(){var e,t=this,a=[];if(this.state.certificateList.forEach((function(e,l){var n,r,o=new Date(1e3*e.expiration),c=new Date(1e3*e.last_used);t.state.activeCert&&e.certificate_id===t.state.activeCert.certificate_id&&(r=s.default.createElement("i",{className:"far fa-check-circle btn-icon-right text-success"})),n=!0===e.enabled?s.default.createElement("div",{className:"btn-group",role:"group"},s.default.createElement("button",{type:"button",className:"btn btn-secondary",onClick:function(a){return t.switchCertStatus(e)},title:i.default.t("admin.switch-off")},s.default.createElement("i",{className:"fas fa-toggle-on"})),s.default.createElement("button",{type:"button",className:"btn btn-secondary",onClick:function(a){return t.deleteCert(a,e)},title:i.default.t("admin.delete")},s.default.createElement("i",{className:"fas fa-trash"}))):!1===e.enabled?s.default.createElement("div",{className:"btn-group",role:"group"},s.default.createElement("button",{type:"button",className:"btn btn-secondary",onClick:function(a){return t.switchCertStatus(e)},title:i.default.t("admin.switch-on")},s.default.createElement("i",{className:"fas fa-toggle-off"})),s.default.createElement("button",{type:"button",className:"btn btn-secondary",onClick:function(a){return t.deleteCert(a,e)},title:i.default.t("admin.delete")},s.default.createElement("i",{className:"fas fa-trash"}))):s.default.createElement("div",{className:"btn-group",role:"group"},s.default.createElement("button",{type:"button",disabled:!0,className:"btn btn-secondary",title:i.default.t("admin.switch-off")},s.default.createElement("i",{className:"fas fa-toggle-on"})),s.default.createElement("button",{type:"button",disabled:!0,className:"btn btn-secondary",title:i.default.t("admin.delete")},s.default.createElement("i",{className:"fas fa-trash"}))),a.push(s.default.createElement("tr",{key:l},s.default.createElement("td",null,s.default.createElement("span",{className:"d-inline-block",tabIndex:"0","data-toggle":"tooltip",title:e.certificate_dn},e.certificate_dn.substring(0,8),"[...]"),r),s.default.createElement("td",{className:"d-none d-lg-table-cell"},s.default.createElement("span",{className:"d-inline-block",tabIndex:"1","data-toggle":"tooltip",title:e.certificate_issuer_dn},e.certificate_issuer_dn.substring(0,8),"[...]")),s.default.createElement("td",{className:"d-none d-lg-table-cell"},o.toLocaleString()),s.default.createElement("td",{className:"d-none d-lg-table-cell"},c.toLocaleString()),s.default.createElement("td",null,n)))})),this.state.downloadCert){var l="********";this.state.showPassword&&(l=this.state.downloadCert.password),e=s.default.createElement("div",null,s.default.createElement("div",{className:"row"},s.default.createElement("div",{className:"col-md-3"},s.default.createElement("a",{className:"btn btn-primary",download:"cert.p12",href:"data:application/x-pkcs12;base64,"+this.state.downloadCert.p12,target:"_blank"},i.default.t("profile.scheme-certificate-p12-file-save"))),s.default.createElement("div",{className:"col-md-4"},s.default.createElement("h5",null,i.default.t("profile.scheme-certificate-p12-file-password"),s.default.createElement("code",{className:"btn-icon-right"},l))),s.default.createElement("div",{className:"col-md-2"},s.default.createElement("div",{className:"btn-group",role:"group","aria-label":"current-certificate"},s.default.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:this.showPassword,title:i.default.t("profile.scheme-certificate-p12-file-"+(this.state.showPassword?"hide-password":"show-password"))},s.default.createElement("i",{className:"fas "+(this.state.showPassword?"fa-eye-slash":"fa-eye")})),s.default.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:this.copyPassword,title:i.default.t("profile.scheme-certificate-p12-file-copy-password")},s.default.createElement("i",{className:"fas fa-copy"}))))))}return s.default.createElement("div",null,s.default.createElement("div",{className:"row"},s.default.createElement("div",{className:"col-md-12"},s.default.createElement("h4",null,i.default.t("profile.scheme-certificate-title",{module:this.state.module,name:this.state.name})))),s.default.createElement("div",{className:"row"},s.default.createElement("div",{className:"col-md-6"},s.default.createElement("div",{className:"input-group mb-3"},s.default.createElement("div",{className:"input-group-prepend"},s.default.createElement("button",{className:"btn btn-outline-secondary",type:"button",disabled:!this.state.canAddCert,id:"addCertificateFromFile",title:i.default.t("profile.scheme-certificate-add-from-file"),onClick:this.addCertificateFile},i.default.t("upload"))),s.default.createElement("div",{className:"custom-file"},s.default.createElement("input",{type:"file",disabled:!this.state.canAddCert,className:"custom-file-input",id:"addCertificateFromFileInput","aria-describedby":"addCertificateFromFile",onChange:function(e){return t.selectCertFile(e)}}),s.default.createElement("label",{className:"custom-file-label",htmlFor:"addCertificateFromFile"},this.state.fileName||i.default.t("browse"))))),s.default.createElement("div",{className:"col-md-6"},s.default.createElement("div",{className:"btn-group",role:"group","aria-label":"current-certificate"},s.default.createElement("button",{type:"button",className:"btn btn-outline-secondary",disabled:!this.state.canAddCert,onClick:this.addCertificateFromRequest,title:i.default.t("profile.scheme-certificate-add-from-request")},s.default.createElement("i",{className:"fas fa-file-contract"})),s.default.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:this.testCertificate,title:i.default.t("profile.scheme-certificate-test")},s.default.createElement("i",{className:"fas fa-question-circle"})),s.default.createElement("button",{type:"button",className:"btn btn-outline-secondary",disabled:!this.state.canRequestCert,onClick:this.requestNewCertificate,title:i.default.t("profile.scheme-certificate-request-new")},s.default.createElement("i",{className:"fas fa-external-link-alt"})),s.default.createElement("button",{type:"button",className:"btn btn-outline-secondary",onClick:this.getRegister,title:i.default.t("profile.scheme-certificate-refresh")},s.default.createElement("i",{className:"fas fa-sync"}))))),s.default.createElement("div",{className:"row"},s.default.createElement("div",{className:"col-md-12"},s.default.createElement("table",{className:"table table-responsive table-striped"},s.default.createElement("thead",null,s.default.createElement("tr",null,s.default.createElement("th",null,i.default.t("profile.scheme-certificate-table-certificate_dn")),s.default.createElement("th",{className:"d-none d-lg-table-cell"},i.default.t("profile.scheme-certificate-table-certificate_issuer_dn")),s.default.createElement("th",{className:"d-none d-lg-table-cell"},i.default.t("profile.scheme-certificate-table-expiration")),s.default.createElement("th",{className:"d-none d-lg-table-cell"},i.default.t("profile.scheme-certificate-table-last_used")),s.default.createElement("th",null))),s.default.createElement("tbody",null,a)))),s.default.createElement("div",{className:"row"},s.default.createElement("div",{className:"col-md-12"},s.default.createElement("hr",null))),e)}}]),u);function u(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u);var t=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(u.__proto__||Object.getPrototypeOf(u)).call(this,e));return t.state={config:e.config,module:e.module,name:e.name,profile:e.profile,registered:!1,registration:!1,certificateList:[],addModal:!1,certFile:!1,curCert:!1,fileName:!1,activeCert:!1,downloadCert:!1,showPassword:!1,canAddCert:!1,canRequestCert:!1},t.getRegister=t.getRegister.bind(t),t.selectCertFile=t.selectCertFile.bind(t),t.addCertificateFile=t.addCertificateFile.bind(t),t.addCertificateFromRequest=t.addCertificateFromRequest.bind(t),t.requestNewCertificate=t.requestNewCertificate.bind(t),t.switchCertStatus=t.switchCertStatus.bind(t),t.deleteCert=t.deleteCert.bind(t),t.confirmDeleteCert=t.confirmDeleteCert.bind(t),t.testCertificate=t.testCertificate.bind(t),t.showPassword=t.showPassword.bind(t),t.copyPassword=t.copyPassword.bind(t),t.getRegister(),t}t.default=d},83:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});function l(e,t){for(var a=0;a<t.length;a++){var l=t[a];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(e,l.key,l)}}var n=a(0),s=r(n),i=r(a(1));function r(e){return e&&e.__esModule?e:{default:e}}var o=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(c,n.Component),function(e,t,a){t&&l(e.prototype,t),a&&l(e,a)}(c,[{key:"componentWillReceiveProps",value:function(e){this.setState({title:e.title,message:e.message})}},{key:"closeModal",value:function(e,t){$("#messageModal").modal("hide")}},{key:"render",value:function(){var e=this,t=[];return this.state.message&&this.state.message.forEach((function(e,a){t.push(s.default.createElement("li",{key:a},e))})),s.default.createElement("div",{className:"modal fade",id:"messageModal",tabIndex:"-1",role:"dialog","aria-labelledby":"messageModalLabel","aria-hidden":"true"},s.default.createElement("div",{className:"modal-dialog",role:"document"},s.default.createElement("div",{className:"modal-content"},s.default.createElement("div",{className:"modal-header"},s.default.createElement("h5",{className:"modal-title",id:"messageModalLabel"},this.state.title),s.default.createElement("button",{type:"button",className:"close","aria-label":i.default.t("modal.close"),onClick:function(t){return e.closeModal(t,!1)}},s.default.createElement("span",{"aria-hidden":"true"},"×"))),s.default.createElement("div",{className:"modal-body"},s.default.createElement("ul",null,t)),s.default.createElement("div",{className:"modal-footer"},s.default.createElement("button",{type:"button",className:"btn btn-secondary",onClick:function(t){return e.closeModal(t,!1)}},i.default.t("modal.close"))))))}}]),c);function c(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c);var t=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(c.__proto__||Object.getPrototypeOf(c)).call(this,e));return t.state={title:e.title,message:e.message},t.closeModal=t.closeModal.bind(t),t}t.default=o}})}));