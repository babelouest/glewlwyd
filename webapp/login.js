!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var n=t();for(var r in n)("object"==typeof exports?exports:e)[r]=n[r]}}(window,function(){return function(e){function t(t){for(var r,c,s=t[0],i=t[1],l=t[2],f=0,m=[];f<s.length;f++)c=s[f],Object.prototype.hasOwnProperty.call(a,c)&&a[c]&&m.push(a[c][0]),a[c]=0;for(r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r]);for(u&&u(t);m.length;)m.shift()();return o.push.apply(o,l||[]),n()}function n(){for(var e,t=0;t<o.length;t++){for(var n=o[t],r=!0,s=1;s<n.length;s++){var i=n[s];0!==a[i]&&(r=!1)}r&&(o.splice(t--,1),e=c(c.s=n[0]))}return e}var r={},a={3:0},o=[];function c(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,c),n.l=!0,n.exports}c.m=e,c.c=r,c.d=function(e,t,n){c.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},c.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},c.t=function(e,t){if(1&t&&(e=c(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(c.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)c.d(n,r,function(t){return e[t]}.bind(null,r));return n},c.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return c.d(t,"a",t),t},c.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},c.p="";var s=window.webpackJsonp=window.webpackJsonp||[],i=s.push.bind(s);s.push=t,s=s.slice();for(var l=0;l<s.length;l++)t(s[l]);var u=i;return o.push([21,0]),n()}({2:function(e,t,n){"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var a=new(function(){function e(){!function(t,n){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this),this.subscriberList={}}return function(e,t,n){t&&r(e.prototype,t)}(e,[{key:"subscribe",value:function(e,t){this.subscriberList[e]=t}},{key:"sendMessage",value:function(e,t){if(Array.isArray(e)||(e=[e]),"broadcast"===e[0])this.subscriberList.forEach(function(e,n){e({type:"broadcast",message:t})});else for(var n in this.subscriberList)0<=e.indexOf(n)&&this.subscriberList[n](t)}}]),e}());t.a=a},21:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),o=n(5),c=n.n(o),s=n(1),i=n(10),l=n(11),u=n(3),f=n(2),m=n(4);function p(e){return(p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function h(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function d(e,t){return(d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function g(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function y(e){return(y=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var b=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&d(e,t)}(t,r.Component);var e=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=y(e);if(t){var a=y(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return function(e,t){return!t||"object"!==p(t)&&"function"!=typeof t?g(e):t}(this,n)}}(t);function t(n){var r;return function(e,n){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),(r=e.call(this,n)).state={config:n.config,userList:n.userList,currentUser:n.currentUser,client:n.client,newUser:n.newUser,newUserScheme:n.newUserScheme,canContinue:n.canContinue,showGrant:n.showGrant,schemeListRequired:n.schemeListRequired,bGrantTitle:n.showGrant?s.a.t("login.grant-auth-title"):s.a.t("login.grant-change-title"),bGrant:n.showGrant?s.a.t("login.grant-auth"):s.a.t("login.grant-change"),showGrantAsterisk:n.showGrantAsterisk,selectAccount:n.selectAccount},r.clickLogout=r.clickLogout.bind(g(r)),r.clickGrant=r.clickGrant.bind(g(r)),r.clickContinue=r.clickContinue.bind(g(r)),r.newUser=r.newUser.bind(g(r)),r.managerUsers=r.managerUsers.bind(g(r)),r.changeSessionScheme=r.changeSessionScheme.bind(g(r)),r.registerNewUser=r.registerNewUser.bind(g(r)),r}return function(e,t,n){t&&h(e.prototype,t)}(t,[{key:"componentWillReceiveProps",value:function(e){this.setState({userList:e.userList,currentUser:e.currentUser,client:e.client,config:e.config,showGrant:e.showGrant,newUser:e.newUser,newUserScheme:e.newUserScheme,canContinue:e.canContinue,schemeListRequired:e.schemeListRequired,bGrantTitle:e.showGrant?s.a.t("login.grant-auth-title"):s.a.t("login.grant-change-title"),bGrant:e.showGrant?s.a.t("login.grant-auth"):s.a.t("login.grant-change"),showGrantAsterisk:e.showGrantAsterisk,selectAccount:e.selectAccount})}},{key:"clickLogout",value:function(){u.a.glewlwydRequest("/auth/?username="+this.state.currentUser.username,"DELETE").then(function(){f.a.sendMessage("App",{type:"InitProfile"})}).fail(function(){f.a.sendMessage("Notification",{type:"danger",message:s.a.t("login.error-delete-session")}),f.a.sendMessage("App",{type:"InitProfile"})})}},{key:"clickGrant",value:function(){f.a.sendMessage("App",{type:"ToggleGrant"})}},{key:"clickContinue",value:function(){this.state.config.params.callback_url&&(document.location.href=this.state.config.params.callback_url+(0<this.state.config.params.callback_url.indexOf("?")?"&g_continue":"?g_continue"))}},{key:"newUser",value:function(e,t){e.preventDefault(),t?u.a.glewlwydRequest("/auth/","POST",{username:t}).then(function(){f.a.sendMessage("App",{type:"InitProfile"})}).fail(function(){f.a.sendMessage("Notification",{type:"danger",message:s.a.t("login.error-login")})}):f.a.sendMessage("App",{type:"NewUser"})}},{key:"registerNewUser",value:function(e,t){e.preventDefault(),document.location.href=this.state.config.ProfileUrl+"?register="+encodeURIComponent(t)}},{key:"managerUsers",value:function(e){e.preventDefault(),f.a.sendMessage("App",{type:"SelectAccount"})}},{key:"changeSessionScheme",value:function(e,t){e.preventDefault(),f.a.sendMessage("App",{type:"newUserScheme",scheme:t})}},{key:"render",value:function(){var e=this,t="",n="",r="",o="",c=[];if(this.state.canContinue&&(r=a.a.createElement("button",{type:"button",className:"btn btn-success",onClick:this.clickContinue,title:s.a.t("login.continue-title")},a.a.createElement("i",{className:"fas fa-play btn-icon"}),s.a.t("login.continue"))),this.state.showGrantAsterisk&&(n=a.a.createElement("small",null,a.a.createElement("i",{className:"fas fa-asterisk btn-icon-right"}))),this.state.client&&(o=a.a.createElement("div",null,a.a.createElement("a",{className:"dropdown-item",href:"#",onClick:this.clickGrant,alt:this.state.bGrantTitle},a.a.createElement("i",{className:"fas fa-user-cog btn-icon"}),this.state.bGrant,n),a.a.createElement("div",{className:"dropdown-divider"}))),this.state.currentUser&&!this.state.selectAccount){this.state.config.register&&this.state.config.register.forEach(function(t,n){c.push(a.a.createElement("a",{key:n,className:"dropdown-item",href:"#",onClick:function(n){return e.registerNewUser(n,t.name)}},s.a.t(t.message)))});var i=[];return this.state.userList&&this.state.userList.forEach(function(t,n){e.state.currentUser.username===t.username?i.push(a.a.createElement("a",{className:"dropdown-item active",href:"#",onClick:function(n){return e.newUser(n,t.username)},key:n,alt:t.name||t.username},t.name||t.username)):i.push(a.a.createElement("a",{className:"dropdown-item",href:"#",onClick:function(n){return e.newUser(n,t.username)},key:n,alt:t.name||t.username},t.name||t.username))}),t=a.a.createElement("div",{className:"btn-group",role:"group"},a.a.createElement("button",{className:"btn btn-secondary dropdown-toggle",type:"button",id:"selectNewUser","data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false"},a.a.createElement("i",{className:"fas fa-users btn-icon"}),s.a.t("login.login-another")),a.a.createElement("div",{className:"dropdown-menu","aria-labelledby":"selectNewUser"},a.a.createElement("a",{className:"dropdown-item",href:"#",onClick:function(t){return e.newUser(t,!1)}},s.a.t("profile.menu-session-new")),a.a.createElement("a",{className:"dropdown-item",href:"#",onClick:function(t){return e.managerUsers(t)}},s.a.t("login.manage-users")),c,a.a.createElement("div",{className:"dropdown-divider"}),i)),a.a.createElement("div",{className:"text-center"},a.a.createElement("div",{className:"btn-group",role:"group"},r,a.a.createElement("button",{type:"button",className:"btn btn-danger",onClick:this.clickLogout},a.a.createElement("i",{className:"fas fa-sign-out-alt btn-icon"}),s.a.t("login.logout"))),a.a.createElement("div",null,a.a.createElement("hr",null),a.a.createElement("div",{className:"btn-group",role:"group"},a.a.createElement("div",{className:"btn-group",role:"group"},a.a.createElement("button",{className:"btn btn-secondary dropdown-toggle",type:"button",id:"selectGrant","data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false"},a.a.createElement("i",{className:"fas fa-user-cog btn-icon"}),s.a.t("login.login-handle"),n),a.a.createElement("div",{className:"dropdown-menu","aria-labelledby":"selectGrant"},o,a.a.createElement("a",{className:"dropdown-item",href:this.state.config.ProfileUrl||"",target:"_blank"},s.a.t("login.update-profile")))),t)))}if(this.state.newUser){this.state.config.register&&this.state.config.register.forEach(function(t,n){c.push(a.a.createElement("button",{key:n,type:"button",className:"btn btn-primary",onClick:function(n){return e.registerNewUser(n,t.name)}},s.a.t(t.message)))});var l=[];return this.state.config.sessionSchemes&&this.state.config.sessionSchemes.length?(this.state.newUserScheme?l.push(a.a.createElement("a",{key:0,className:"dropdown-item",href:"#",onClick:function(t){return e.changeSessionScheme(t,!1)},alt:s.a.t("login.password-title")},s.a.t("login.password-title"))):l.push(a.a.createElement("a",{key:0,className:"dropdown-item active",href:"#",onClick:function(t){return e.changeSessionScheme(t,!1)},alt:s.a.t("login.password-title")},s.a.t("login.password-title"))),l.push(a.a.createElement("div",{key:1,className:"dropdown-divider"})),this.state.config.sessionSchemes.forEach(function(t,n){!1!==t.show_nopassword_form&&(t.scheme_name===e.state.newUserScheme?l.push(a.a.createElement("a",{key:n+2,className:"dropdown-item active",href:"#",onClick:function(n){return e.changeSessionScheme(n,t.scheme_name)},alt:s.a.t(t.scheme_display_name)},s.a.t(t.scheme_display_name))):l.push(a.a.createElement("a",{key:n+2,className:"dropdown-item",href:"#",onClick:function(n){return e.changeSessionScheme(n,t.scheme_name)},alt:s.a.t(t.scheme_display_name)},s.a.t(t.scheme_display_name))))}),a.a.createElement("div",{className:"btn-group",role:"group"},a.a.createElement("div",{className:"btn-group",role:"group"},a.a.createElement("button",{className:"btn btn-primary dropdown-toggle",type:"button",id:"selectScheme","data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false"},a.a.createElement("i",{className:"fas fa-user-lock btn-icon"}),s.a.t("login.login-choose-scheme")),a.a.createElement("div",{className:"dropdown-menu","aria-labelledby":"selectScheme"},l)),c)):a.a.createElement("div",null,c)}return""}}]),t}();function v(e){return(v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function w(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function E(e,t){return(E=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function S(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function N(e){return(N=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var _=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&E(e,t)}(t,r.Component);var e=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=N(e);if(t){var a=N(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return function(e,t){return!t||"object"!==v(t)&&"function"!=typeof t?S(e):t}(this,n)}}(t);function t(n){var r;return function(e,n){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),(r=e.call(this,n)).state={config:n.config,currentUser:n.currentUser,client:n.client,scope:n.scope,show:n.show,infoSomeScopeUnavailable:n.infoSomeScopeUnavailable},r.handleToggleGrantScope=r.handleToggleGrantScope.bind(S(r)),r.handleGrantScope=r.handleGrantScope.bind(S(r)),f.a.subscribe("GrantScope",function(e){}),r}return function(e,t,n){t&&w(e.prototype,t)}(t,[{key:"componentWillReceiveProps",value:function(e){this.setState({config:e.config,currentUser:e.currentUser,client:e.client,scope:e.scope,show:e.show,infoSomeScopeUnavailable:e.infoSomeScopeUnavailable})}},{key:"handleToggleGrantScope",value:function(e){var t=this.state.scope;t.forEach(function(t){t.name===e.name&&(t.granted=!t.granted)}),this.setState({scope:t})}},{key:"handleGrantScope",value:function(){var e=[];this.state.scope.forEach(function(t){t.granted&&e.push(t.name)}),u.a.glewlwydRequest("/auth/grant/"+encodeURIComponent(this.state.client.client_id),"PUT",{scope:e.join(" ")}).then(function(){f.a.sendMessage("App",{type:"GrantComplete"})}).fail(function(){f.a.sendMessage("Notification",{type:"danger",message:s.a.t("login.error-set-grant")})})}},{key:"render",value:function(){var e,t=this,n=[];return this.state.scope.forEach(function(e,r){"openid"===e.name?n.push(a.a.createElement("li",{className:"list-group-item",key:r},a.a.createElement("div",{className:"form-group form-check"},a.a.createElement("input",{type:"checkbox",className:"form-check-input",checked:!0,disabled:!0}),a.a.createElement("label",{className:"form-check-label",htmlFor:"grant-"+e.name},e.display_name)))):n.push(a.a.createElement("li",{className:"list-group-item",key:r},a.a.createElement("div",{className:"form-group form-check"},a.a.createElement("input",{type:"checkbox",className:"form-check-input",onChange:function(){return t.handleToggleGrantScope(e)},id:"grant-"+e.name,checked:e.granted}),a.a.createElement("label",{className:"form-check-label",htmlFor:"grant-"+e.name},e.display_name))))}),this.state.infoSomeScopeUnavailable&&(e=a.a.createElement("div",{className:"alert alert-info",role:"alert"},s.a.t("login.info-some-scope-unavailable"))),a.a.createElement("div",null,a.a.createElement("div",{className:"row"},a.a.createElement("div",{className:"col-md-12"},a.a.createElement("h5",null,s.a.t("login.grant-title",{client:this.state.client.name})))),a.a.createElement("div",{className:"row"},a.a.createElement("div",{className:"col-md-12"},a.a.createElement("ul",{className:"list-group"},n))),a.a.createElement("div",{className:"row"},a.a.createElement("div",{className:"col-md-12"},e)),a.a.createElement("div",{className:"row"},a.a.createElement("div",{className:"col-md-12"},a.a.createElement("button",{type:"button",className:"btn btn-primary",onClick:this.handleGrantScope},s.a.t("login.grant")))),a.a.createElement("hr",{className:"glwd-hr-no-border"}),a.a.createElement("div",{className:"row"},a.a.createElement("div",{className:"col-md-12"},a.a.createElement("b",null,s.a.t("login.grant-info-message")))))}}]),t}();function k(e){return(k="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function O(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function U(e,t){return(U=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function P(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function R(e){return(R=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var C=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&U(e,t)}(t,r.Component);var e=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=R(e);if(t){var a=R(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return function(e,t){return!t||"object"!==k(t)&&"function"!=typeof t?P(e):t}(this,n)}}(t);function t(n){var r;return function(e,n){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),(r=e.call(this,n)).state={config:n.config,scheme:n.scheme,currentUser:n.currentUser,triggerResult:!1,mockValue:""},r.triggerScheme=r.triggerScheme.bind(P(r)),r.validateMockValue=r.validateMockValue.bind(P(r)),r.handleChangeMockValue=r.handleChangeMockValue.bind(P(r)),r.triggerScheme(),r}return function(e,t,n){t&&O(e.prototype,t)}(t,[{key:"componentWillReceiveProps",value:function(e){var t=this;this.setState({config:e.config,scheme:e.scheme,currentUser:e.currentUser,triggerResult:!1,mockValue:""},function(){t.triggerScheme()})}},{key:"triggerScheme",value:function(){var e=this;if(this.state.scheme&&this.state.currentUser){var t={scheme_type:this.state.scheme.scheme_type,scheme_name:this.state.scheme.scheme_name,username:this.state.currentUser.username,value:{description:"This is a mock trigger"}};u.a.glewlwydRequest("/auth/scheme/trigger/","POST",t,!0).then(function(t){e.setState({triggerResult:t.code})}).fail(function(e){401===e.status?f.a.sendMessage("Notification",{type:"info",message:s.a.t("login.mock-trigger-must-register")}):f.a.sendMessage("Notification",{type:"danger",message:s.a.t("login.error-mock-trigger")})})}}},{key:"handleChangeMockValue",value:function(e){this.setState({mockValue:e.target.value})}},{key:"validateMockValue",value:function(e){e.preventDefault();var t={scheme_type:this.state.scheme.scheme_type,scheme_name:this.state.scheme.scheme_name,username:this.state.currentUser.username,value:{code:this.state.mockValue}};u.a.glewlwydRequest("/auth/","POST",t).then(function(){f.a.sendMessage("App",{type:"loginSuccess",loginSuccess:!0})}).fail(function(){f.a.sendMessage("Notification",{type:"danger",message:s.a.t("login.error-mock-value")})})}},{key:"render",value:function(){var e=this;return this.state.triggerResult?a.a.createElement("form",{action:"#",id:"mockSchemeForm"},a.a.createElement("div",{className:"form-group"},a.a.createElement("h5",null,s.a.t("login.enter-mock-scheme-value"))),a.a.createElement("div",{className:"form-group"},a.a.createElement("div",{className:"input-group mb-3"},a.a.createElement("div",{className:"input-group-prepend"},a.a.createElement("label",{className:"input-group-text",htmlFor:"mockValue"},s.a.t("login.mock-value-label"))),a.a.createElement("input",{type:"text",className:"form-control",name:"mockValue",id:"mockValue",autoFocus:!0,required:"",placeholder:s.a.t("login.error-mock-expected",{value:this.state.triggerResult}),value:this.state.mockValue||"",onChange:this.handleChangeMockValue,autoComplete:"false"}))),a.a.createElement("button",{type:"submit",name:"mockbut",id:"mockbut",className:"btn btn-primary",onClick:function(t){return e.validateMockValue(t)},title:s.a.t("login.mock-value-button-title")},s.a.t("login.btn-ok"))):a.a.createElement("button",{type:"button",className:"btn btn-primary",onClick:this.triggerScheme},s.a.t("login.btn-reload"))}}]),t}();function j(e){return(j="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function L(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function x(e,t){return(x=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function A(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function T(e){return(T=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var G=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&x(e,t)}(t,r.Component);var e=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=T(e);if(t){var a=T(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return function(e,t){return!t||"object"!==j(t)&&"function"!=typeof t?A(e):t}(this,n)}}(t);function t(n){var r;return function(e,n){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),(r=e.call(this,n)).state={config:n.config,scheme:n.scheme,currentUser:n.currentUser,code:"",showValidate:!1},r.triggerScheme=r.triggerScheme.bind(A(r)),r.validateCode=r.validateCode.bind(A(r)),r.handleChangeCode=r.handleChangeCode.bind(A(r)),r}return function(e,t,n){t&&L(e.prototype,t)}(t,[{key:"componentWillReceiveProps",value:function(e){this.setState({config:e.config,scheme:e.scheme,currentUser:e.currentUser,code:"",showValidate:!1})}},{key:"triggerScheme",value:function(e){var t=this;if(e.preventDefault(),this.state.scheme&&this.state.currentUser){var n={scheme_type:this.state.scheme.scheme_type,scheme_name:this.state.scheme.scheme_name,username:this.state.currentUser.username,value:{}};u.a.glewlwydRequest("/auth/scheme/trigger/","POST",n).then(function(e){f.a.sendMessage("Notification",{type:"info",message:s.a.t("login.mail-trigger-ok")}),t.setState({showValidate:!0})}).fail(function(e){f.a.sendMessage("Notification",{type:"danger",message:s.a.t("login.mail-trigger-error")})})}}},{key:"handleChangeCode",value:function(e){this.setState({code:e.target.value})}},{key:"validateCode",value:function(e){e.preventDefault();var t={scheme_type:this.state.scheme.scheme_type,scheme_name:this.state.scheme.scheme_name,username:this.state.currentUser.username,value:{code:this.state.code}};u.a.glewlwydRequest("/auth/","POST",t,!0).then(function(){f.a.sendMessage("App",{type:"loginSuccess"})}).fail(function(e){401===e.status?f.a.sendMessage("Notification",{type:"danger",message:s.a.t("login.mail-code-invalid")}):f.a.sendMessage("Notification",{type:"danger",message:s.a.t("login.mail-code-error")})})}},{key:"render",value:function(){var e,t,n=this;return this.state.showValidate&&(e=a.a.createElement("button",{type:"submit",name:"mailbut",id:"mailbut",className:"btn btn-primary",onClick:function(e){return n.validateCode(e)},title:s.a.t("login.mail-code-button-title")},s.a.t("login.btn-ok")),t=a.a.createElement("input",{type:"text",className:"form-control",name:"code",id:"code",autoFocus:!0,required:"",placeholder:s.a.t("login.mail-code-ph"),value:this.state.code||"",onChange:this.handleChangeCode,autoComplete:"false"})),a.a.createElement("form",{action:"#",id:"mailSchemeForm",onSubmit:function(e){return n.validateCode(e)}},a.a.createElement("div",{className:"form-group"},a.a.createElement("h5",null,s.a.t("login.mail-enter-scheme-code"))),a.a.createElement("div",{className:"form-group"},a.a.createElement("div",{className:"input-group mb-3"},a.a.createElement("div",{className:"input-group-prepend"},a.a.createElement("label",{className:"input-group-text",htmlFor:"code"},s.a.t("login.mail-code-label"))),t)),a.a.createElement("div",{className:"btn-group",role:"group"},e,a.a.createElement("button",{type:"button",name:"triggerbut",id:"triggerbut",className:"btn btn-primary",onClick:this.triggerScheme,title:s.a.t("login.mail-trigger-button-title")},s.a.t("login.mail-scheme-trigger"))))}}]),t}();function M(e){return(M="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function q(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function D(e,t){return(D=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function V(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function I(e){return(I=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var F=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&D(e,t)}(t,r.Component);var e=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=I(e);if(t){var a=I(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return function(e,t){return!t||"object"!==M(t)&&"function"!=typeof t?V(e):t}(this,n)}}(t);function t(n){var r;return function(e,n){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),(r=e.call(this,n)).state={config:n.config,scheme:n.scheme,currentUser:n.currentUser,canLogin:!1,webauthnEnabled:!!window.PublicKeyCredential},r.triggerScheme=r.triggerScheme.bind(V(r)),r.login=r.login.bind(V(r)),r.triggerScheme(),r}return function(e,t,n){t&&q(e.prototype,t)}(t,[{key:"componentWillReceiveProps",value:function(e){var t=this;this.setState({config:e.config,scheme:e.scheme,currentUser:e.currentUser},function(){t.triggerScheme()})}},{key:"strToBin",value:function(e){return Uint8Array.from(atob(e),function(e){return e.charCodeAt(0)})}},{key:"binToStr",value:function(e){return btoa(new Uint8Array(e).reduce(function(e,t){return e+String.fromCharCode(t)},""))}},{key:"login",value:function(e){var t=this;u.a.glewlwydRequest("/auth/scheme/trigger/","POST",{username:this.state.currentUser.username,scheme_type:this.state.scheme.scheme_type,scheme_name:this.state.scheme.scheme_name,value:{}}).then(function(e){var n=[];e.allowCredentials.forEach(function(e){n.push({id:t.strToBin(e.credential_id),type:"public-key"})});var r={allowCredentials:n,challenge:t.strToBin(e.challenge)};navigator.credentials.get({publicKey:r}).then(function(n){var r={};"id"in n&&(r.id=n.id),"type"in n&&(r.type=n.type),"rawId"in n&&(r.rawId=t.binToStr(n.rawId)),r.response={clientDataJSON:t.binToStr(n.response.clientDataJSON),authenticatorData:t.binToStr(n.response.authenticatorData),signature:t.binToStr(n.response.signature),userHandle:t.binToStr(n.response.userHandle)},n.response.getTransports&&(response.transports=n.response.getTransports()),u.a.glewlwydRequest("/auth/","POST",{username:t.state.currentUser.username,scheme_type:t.state.scheme.scheme_type,scheme_name:t.state.scheme.scheme_name,value:{session:e.session,credential:r}}).then(function(){f.a.sendMessage("App",{type:"loginSuccess"}),f.a.sendMessage("Notification",{type:"info",message:s.a.t("profile.scheme-webauthn-assertion-success")})}).fail(function(e){401===e.status?f.a.sendMessage("Notification",{type:"danger",message:s.a.t("profile.scheme-webauthn-assertion-error")}):f.a.sendMessage("Notification",{type:"danger",message:s.a.t("error-api-connect")})})}).catch(function(e){f.a.sendMessage("Notification",{type:"danger",message:s.a.t("profile.scheme-webauthn-error-assertion")})})}).fail(function(e){f.a.sendMessage("Notification",{type:"danger",message:s.a.t("error-api-connect")})})}},{key:"triggerScheme",value:function(){var e=this;if(this.state.scheme&&this.state.currentUser){var t={scheme_type:this.state.scheme.scheme_type,scheme_name:this.state.scheme.scheme_name,username:this.state.currentUser.username,value:{}};u.a.glewlwydRequest("/auth/scheme/trigger/","POST",t).then(function(t){e.setState({canLogin:!0})}).fail(function(t){e.setState({canLogin:!1},function(){401===t.status?f.a.sendMessage("Notification",{type:"info",message:s.a.t("login.webauthn-trigger-must-register")}):f.a.sendMessage("Notification",{type:"danger",message:s.a.t("login.webauthn-error-trigger")})})})}}},{key:"render",value:function(){var e,t=this;return this.state.webauthnEnabled||(e=a.a.createElement("div",{className:"row"},a.a.createElement("div",{className:"col-md-12"},a.a.createElement("div",{className:"alert alert-danger",role:"alert"},s.a.t("profile.scheme-webauthn-disabled"))))),a.a.createElement("div",null,a.a.createElement("div",{className:"form-group"},a.a.createElement("h5",null,s.a.t("login.webauthn-login-title"))),a.a.createElement("div",{className:"form-group"},e),a.a.createElement("button",{type:"button",name:"loginBut",id:"loginBut",disabled:!this.state.canLogin||!this.state.webauthnEnabled,className:"btn btn-primary",onClick:function(e){return t.login(e)},title:s.a.t("login.webauthn-login-button-title")},s.a.t("login.webauthn-login-authenticate")))}}]),t}();function W(e){return(W="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function B(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function J(e,t){return(J=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function z(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function H(e){return(H=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var K=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&J(e,t)}(t,r.Component);var e=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=H(e);if(t){var a=H(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return function(e,t){return!t||"object"!==W(t)&&"function"!=typeof t?z(e):t}(this,n)}}(t);function t(n){var r;return function(e,n){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),(r=e.call(this,n)).state={config:n.config,scheme:n.scheme,currentUser:n.currentUser,value:""},r.validateOTPValue=r.validateOTPValue.bind(z(r)),r.handleChangeOTPValue=r.handleChangeOTPValue.bind(z(r)),r}return function(e,t,n){t&&B(e.prototype,t)}(t,[{key:"componentWillReceiveProps",value:function(e){this.setState({config:e.config,scheme:e.scheme,currentUser:e.currentUser})}},{key:"handleChangeOTPValue",value:function(e){this.setState({value:e.target.value})}},{key:"validateOTPValue",value:function(e){e.preventDefault();var t={scheme_type:this.state.scheme.scheme_type,scheme_name:this.state.scheme.scheme_name,username:this.state.currentUser.username,value:{value:this.state.value}};u.a.glewlwydRequest("/auth/","POST",t).then(function(){f.a.sendMessage("Notification",{type:"info",message:s.a.t("login.success-login")}),f.a.sendMessage("App",{type:"loginSuccess"})}).fail(function(){f.a.sendMessage("Notification",{type:"danger",message:s.a.t("login.error-login")})})}},{key:"render",value:function(){var e=this;return a.a.createElement("form",{action:"#",id:"otpSchemeForm"},a.a.createElement("div",{className:"form-group"},a.a.createElement("h5",null,s.a.t("login.otp-enter-value"))),a.a.createElement("div",{className:"form-group"},a.a.createElement("div",{className:"input-group mb-3"},a.a.createElement("div",{className:"input-group-prepend"},a.a.createElement("label",{className:"input-group-text",htmlFor:"value"},s.a.t("login.otp-value-label"))),a.a.createElement("input",{type:"text",className:"form-control",name:"value",id:"value",required:"",placeholder:s.a.t("login.error-value-expected",{value:this.state.triggerResult}),value:this.state.value||"",onChange:this.handleChangeOTPValue,autoFocus:!0,autoComplete:"false"}))),a.a.createElement("button",{type:"submit",name:"but",id:"but",className:"btn btn-primary",onClick:function(t){return e.validateOTPValue(t)},title:s.a.t("login.otp-button-title")},s.a.t("login.btn-ok")))}}]),t}();function Q(e){return(Q="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Y(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function X(e,t){return(X=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Z(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ee(e){return(ee=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var te=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&X(e,t)}(t,r.Component);var e=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=ee(e);if(t){var a=ee(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return function(e,t){return!t||"object"!==Q(t)&&"function"!=typeof t?Z(e):t}(this,n)}}(t);function t(n){var r;return function(e,n){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),(r=e.call(this,n)).state={config:n.config,scheme:n.scheme,currentUser:n.currentUser,value:""},r.validatePasswordValue=r.validatePasswordValue.bind(Z(r)),r.handleChangePasswordValue=r.handleChangePasswordValue.bind(Z(r)),r}return function(e,t,n){t&&Y(e.prototype,t)}(t,[{key:"componentWillReceiveProps",value:function(e){this.setState({config:e.config,scheme:e.scheme,currentUser:e.currentUser})}},{key:"handleChangePasswordValue",value:function(e){this.setState({value:e.target.value})}},{key:"validatePasswordValue",value:function(e){e.preventDefault();var t={scheme_type:this.state.scheme.scheme_type,scheme_name:this.state.scheme.scheme_name,username:this.state.currentUser.username,value:{password:this.state.value}};u.a.glewlwydRequest("/auth/","POST",t).then(function(){f.a.sendMessage("Notification",{type:"info",message:s.a.t("login.success-login")}),f.a.sendMessage("App",{type:"loginSuccess"})}).fail(function(){f.a.sendMessage("Notification",{type:"danger",message:s.a.t("login.error-login")})})}},{key:"render",value:function(){var e=this;return a.a.createElement("form",{action:"#",id:"otpSchemeForm"},a.a.createElement("div",{className:"form-group"},a.a.createElement("h5",null,s.a.t("login.password-enter-value"))),a.a.createElement("div",{className:"form-group"},a.a.createElement("div",{className:"input-group mb-3"},a.a.createElement("div",{className:"input-group-prepend"},a.a.createElement("label",{className:"input-group-text",htmlFor:"value"},s.a.t("login.password-value-label"))),a.a.createElement("input",{type:"password",className:"form-control",name:"value",id:"value",required:"",placeholder:s.a.t("login.error-value-expected",{value:this.state.triggerResult}),value:this.state.value||"",onChange:this.handleChangePasswordValue,autoFocus:!0}))),a.a.createElement("button",{type:"submit",name:"but",id:"but",className:"btn btn-primary",onClick:function(t){return e.validatePasswordValue(t)},title:s.a.t("login.password-button-title")},s.a.t("login.btn-ok")))}}]),t}();function ne(e){return(ne="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function re(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ae(e,t){return(ae=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function oe(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ce(e){return(ce=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var se=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ae(e,t)}(t,r.Component);var e=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=ce(e);if(t){var a=ce(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return function(e,t){return!t||"object"!==ne(t)&&"function"!=typeof t?oe(e):t}(this,n)}}(t);function t(n){var r;return function(e,n){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),(r=e.call(this,n)).state={config:n.config,scheme:n.scheme,currentUser:n.currentUser,authResult:!1,authValidated:!1},r.validateCertificate=r.validateCertificate.bind(oe(r)),r}return function(e,t,n){t&&re(e.prototype,t)}(t,[{key:"validateCertificate",value:function(){var e=this;if(!this.state.authResult){var t={scheme_type:this.state.scheme.scheme_type,scheme_name:this.state.scheme.scheme_name,username:this.state.currentUser.username,value:{}};u.a.glewlwydRequest("/auth/","POST",t).then(function(){e.setState({authResult:!0,authValidated:!0},function(){f.a.sendMessage("App",{type:"loginSuccess",loginSuccess:!0})})}).fail(function(){e.setState({authResult:!1,authValidated:!0})})}}},{key:"render",value:function(){var e,t=this;if(!0===this.state.authResult)e=a.a.createElement("div",{className:"alert alert-success",role:"alert"},s.a.t("login.certificate-scheme-auth-success"));else if(!1===this.state.authResult){var n;this.state.authValidated&&(n=a.a.createElement("div",{className:"alert alert-danger",role:"alert"},s.a.t("login.certificate-scheme-auth-invalid"))),e=a.a.createElement("div",null,n,a.a.createElement("button",{type:"button",className:"btn btn-primary",onClick:function(){return t.validateCertificate()}},s.a.t("login.certificate-login-authenticate")))}return a.a.createElement("form",{action:"#",id:"certificateSchemeForm"},a.a.createElement("div",{className:"form-group"},a.a.createElement("h5",null,s.a.t("login.certificate-scheme-title"))),a.a.createElement("div",{className:"form-group"},e))}}]),t}();function ie(e){return(ie="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function le(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ue(e,t){return(ue=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function fe(e){return(fe=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var me=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ue(e,t)}(t,r.Component);var e=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=fe(e);if(t){var a=fe(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return function(e,t){return!t||"object"!==ie(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}(this,n)}}(t);function t(n){var r;return function(e,n){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),(r=e.call(this,n)).state={config:n.config,scheme:n.scheme,currentUser:n.currentUser,providerList:[]},r.getProviderList(),r}return function(e,t,n){t&&le(e.prototype,t)}(t,[{key:"componentWillReceiveProps",value:function(e){var t=this;this.setState({config:e.config,scheme:e.scheme,currentUser:e.currentUser},function(){t.getProviderList()})}},{key:"getProviderList",value:function(){var e=this;if(this.state.scheme&&this.state.currentUser){var t={scheme_type:this.state.scheme.scheme_type,scheme_name:this.state.scheme.scheme_name,username:this.state.currentUser.username,value:{provider_list:!0}};u.a.glewlwydRequest("/auth/scheme/trigger/","POST",t,!0).then(function(t){e.setState({providerList:t})}).fail(function(e){f.a.sendMessage("Notification",{type:"danger",message:s.a.t("error-api-connect")})})}}},{key:"connectProvider",value:function(e){if(this.state.scheme&&this.state.currentUser){var t={scheme_type:this.state.scheme.scheme_type,scheme_name:this.state.scheme.scheme_name,username:this.state.currentUser.username,value:{provider:e,callback_url:window.location.href}};u.a.glewlwydRequest("/auth/scheme/trigger/","POST",t,!0).then(function(e){document.location.href=e.redirect_to}).fail(function(e){f.a.sendMessage("Notification",{type:"danger",message:s.a.t("error-api-connect")})})}}},{key:"render",value:function(){var e=this,t=[];return this.state.providerList.forEach(function(n,r){var o;n.logo_uri?o=a.a.createElement("img",{src:n.logo_uri,alt:n.provider,className:"img-fluid logo-img"}):n.logo_fa&&(o=a.a.createElement("i",{className:n.logo_fa})),t.push(a.a.createElement("div",{key:r},a.a.createElement("hr",null),a.a.createElement("div",{className:"row"},a.a.createElement("button",{type:"button",className:"btn btn-secondary",onClick:function(){return e.connectProvider(n.provider)}},o,a.a.createElement("span",{className:"btn-icon-right"},s.a.t("login.oauth2-connect",{provider:n.provider}))))))}),a.a.createElement("div",null,a.a.createElement("div",{className:"form-group"},a.a.createElement("h5",null,s.a.t("login.oauth2-title"))),a.a.createElement("div",{className:"form-group"},t))}}]),t}();function pe(e){return(pe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function he(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function de(e,t){return(de=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ge(e){return(ge=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var ye=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&de(e,t)}(t,r.Component);var e=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=ge(e);if(t){var a=ge(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return function(e,t){return!t||"object"!==pe(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}(this,n)}}(t);function t(n){var r;return function(e,n){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),(r=e.call(this,n)).state={config:n.config,scheme:n.scheme,currentUser:n.currentUser},r}return function(e,t,n){t&&he(e.prototype,t)}(t,[{key:"componentWillReceiveProps",value:function(e){this.setState({config:e.config,scheme:e.scheme,currentUser:e.currentUser})}},{key:"render",value:function(){return"mock"===this.state.scheme.scheme_type?a.a.createElement(C,{config:this.state.config,scheme:this.state.scheme,currentUser:this.state.currentUser}):"email"===this.state.scheme.scheme_type?a.a.createElement(G,{config:this.state.config,scheme:this.state.scheme,currentUser:this.state.currentUser}):"webauthn"===this.state.scheme.scheme_type?a.a.createElement(F,{config:this.state.config,scheme:this.state.scheme,currentUser:this.state.currentUser}):"otp"===this.state.scheme.scheme_type?a.a.createElement(K,{config:this.state.config,scheme:this.state.scheme,currentUser:this.state.currentUser}):"retype-password"===this.state.scheme.scheme_type||"http"===this.state.scheme.scheme_type?a.a.createElement(te,{config:this.state.config,scheme:this.state.scheme,currentUser:this.state.currentUser}):"certificate"===this.state.scheme.scheme_type?a.a.createElement(se,{config:this.state.config,scheme:this.state.scheme,currentUser:this.state.currentUser}):"oauth2"===this.state.scheme.scheme_type?a.a.createElement(me,{config:this.state.config,scheme:this.state.scheme,currentUser:this.state.currentUser}):""}}]),t}();function be(e){return(be="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ve(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function we(e,t){return(we=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ee(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Se(e){return(Se=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Ne=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&we(e,t)}(t,r.Component);var e=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Se(e);if(t){var a=Se(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return function(e,t){return!t||"object"!==be(t)&&"function"!=typeof t?Ee(e):t}(this,n)}}(t);function t(n){var r;return function(e,n){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),(r=e.call(this,n)).state={config:n.config,scheme:n.scheme,schemeListRequired:n.schemeListRequired,client:n.client,currentUser:n.currentUser,canContinue:!n.scheme,show:n.show},r.handleSelectScheme=r.handleSelectScheme.bind(Ee(r)),r}return function(e,t,n){t&&ve(e.prototype,t)}(t,[{key:"componentWillReceiveProps",value:function(e){this.setState({config:e.config,scheme:e.scheme,schemeListRequired:e.schemeListRequired,client:e.client,currentUser:e.currentUser,canContinue:!e.scheme,show:e.show})}},{key:"handleSelectScheme",value:function(e,t){e.preventDefault(),this.setState({scheme:t})}},{key:"render",value:function(){var e,t=this;if(this.state.canContinue)return e=this.state.client?s.a.t("login.connect-to",{client:this.state.client.name||this.state.client.client_id}):s.a.t("login.connection"),a.a.createElement("div",null,a.a.createElement("div",{className:"row text-center"},a.a.createElement("div",{className:"col-md-12 "},a.a.createElement("h3",null,e))),a.a.createElement("hr",null),a.a.createElement("div",{className:"row text-center"},a.a.createElement("div",{className:"col-md-12"},a.a.createElement("h4",null,s.a.t("login.wish-message")))));var n="",r="",o=[];return this.state.scheme&&(n=a.a.createElement(ye,{config:this.state.config,scheme:this.state.scheme,currentUser:this.state.currentUser}),r=a.a.createElement("div",{className:"row"},a.a.createElement("div",{className:"col-md-12"},a.a.createElement("hr",null)))),this.state.schemeListRequired&&this.state.schemeListRequired.forEach(function(e,n){o.push(a.a.createElement("a",{className:"dropdown-item",key:n,href:"#",onClick:function(n){return t.handleSelectScheme(n,e)}},e.scheme_display_name))}),a.a.createElement("div",null,n,r,a.a.createElement("div",{className:"btn-group",role:"group"},a.a.createElement("button",{className:"btn btn-primary dropdown-toggle",type:"button",id:"selectScheme","data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false"},a.a.createElement("i",{className:"fas fa-user-lock btn-icon"}),s.a.t("login.login-choose-scheme")),a.a.createElement("div",{className:"dropdown-menu","aria-labelledby":"selectScheme"},o)))}}]),t}();function _e(e){return(_e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ke(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Oe(e,t){return(Oe=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ue(e){return(Ue=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Pe=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Oe(e,t)}(t,r.Component);var e=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Ue(e);if(t){var a=Ue(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return function(e,t){return!t||"object"!==_e(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}(this,n)}}(t);function t(n){var r;return function(e,n){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),(r=e.call(this,n)).state={config:n.config,currentUser:n.currentUser,client:n.client,scope:n.scope,scheme:n.scheme,schemeListRequired:n.schemeListRequired,showGrant:n.showGrant,infoSomeScopeUnavailable:n.infoSomeScopeUnavailable,validLogin:n.validLogin},r}return function(e,t,n){t&&ke(e.prototype,t)}(t,[{key:"componentWillReceiveProps",value:function(e){this.setState({config:e.config,currentUser:e.currentUser,client:e.client,scope:e.scope,scheme:e.scheme,schemeListRequired:e.schemeListRequired,showGrant:e.showGrant,infoSomeScopeUnavailable:e.infoSomeScopeUnavailable,validLogin:e.validLogin})}},{key:"render",value:function(){var e,t;if(e=this.state.showGrant?a.a.createElement("div",{id:"carouselBody",className:"carousel slide","data-ride":"carousel"},a.a.createElement("div",{className:"carousel-inner"},a.a.createElement("div",{className:"carousel-item"+(this.state.showGrant?" active":"")},a.a.createElement(_,{config:this.state.config,currentUser:this.state.currentUser,client:this.state.client,scope:this.state.scope,infoSomeScopeUnavailable:this.state.infoSomeScopeUnavailable})))):a.a.createElement("div",{className:"row"},a.a.createElement("div",{className:"col-md-12"},a.a.createElement(Ne,{config:this.state.config,currentUser:this.state.currentUser,scheme:this.state.scheme,schemeListRequired:this.state.schemeListRequired,client:this.state.client}))),this.state.config.profilePicture&&this.state.currentUser[this.state.config.profilePicture.property]){var n=this.state.currentUser[this.state.config.profilePicture.property];Array.isArray(n)&&(n=n[0]),t=a.a.createElement("div",{className:"row"},a.a.createElement("div",{className:"col-md-12 text-center"},a.a.createElement("img",{className:"btn-icon-right img-medium",src:"data:"+this.state.config.profilePicture.type+";base64,"+n,alt:this.state.config.profilePicture.property})))}else t=a.a.createElement("div",{className:"glwd-profile-user-picto-large"},a.a.createElement("i",{className:"fas fa-user"}));return this.state.validLogin?a.a.createElement("div",null,t,a.a.createElement("div",{className:"row"},a.a.createElement("div",{className:"col-md-12 text-center"},a.a.createElement("h4",null,s.a.t("login.hello",{name:this.state.currentUser.name||this.state.currentUser.username})))),a.a.createElement("div",{className:"row"},a.a.createElement("div",{className:"col-md-12"},a.a.createElement("hr",null))),e):a.a.createElement("div",null,a.a.createElement("div",{className:"row"},a.a.createElement("div",{className:"col-md-12 text-center"},a.a.createElement("h3",null,s.a.t("login.error-invalid-url-parameters")))))}}]),t}();function Re(e){return(Re="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ce(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function je(e,t){return(je=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Le(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function xe(e){return(xe=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Ae=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&je(e,t)}(t,r.Component);var e=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=xe(e);if(t){var a=xe(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return function(e,t){return!t||"object"!==Re(t)&&"function"!=typeof t?Le(e):t}(this,n)}}(t);function t(n){var r;return function(e,n){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),(r=e.call(this,n)).state={username:n.username,password:"",config:n.config,currentUser:n.currentUser,userList:n.userList},r.handleChangeUsername=r.handleChangeUsername.bind(Le(r)),r.handleChangePassword=r.handleChangePassword.bind(Le(r)),r.validateLogin=r.validateLogin.bind(Le(r)),r}return function(e,t,n){t&&Ce(e.prototype,t)}(t,[{key:"componentWillReceiveProps",value:function(e){this.setState({username:e.username,password:"",config:e.config,currentUser:e.currentUser,userList:e.userList})}},{key:"handleChangeUsername",value:function(e){this.setState({username:e.target.value})}},{key:"handleChangePassword",value:function(e){this.setState({password:e.target.value})}},{key:"validateLogin",value:function(e){if(e.preventDefault(),this.state.username&&this.state.password){var t={username:this.state.username,password:this.state.password};u.a.glewlwydRequest("/auth/","POST",t).then(function(){f.a.sendMessage("App",{type:"loginSuccess"})}).fail(function(){f.a.sendMessage("Notification",{type:"danger",message:s.a.t("login.error-login")})})}}},{key:"gotoManageUsers",value:function(){f.a.sendMessage("App",{type:"SelectAccount"})}},{key:"render",value:function(){var e,t,n=this;return e=this.state.currentUser?a.a.createElement("input",{type:"text",className:"form-control",name:"username",id:"username",disabled:!0,value:this.state.currentUser.username}):a.a.createElement("input",{type:"text",className:"form-control",name:"username",id:"username",required:"",placeholder:s.a.t("login.login-placeholder"),value:this.state.username,onChange:this.handleChangeUsername,autoFocus:!0}),0<this.state.userList.length&&(t=a.a.createElement("button",{type:"button",className:"btn btn-secondary",onClick:this.gotoManageUsers},s.a.t("login.manage-users"))),a.a.createElement("form",{action:"#",id:"passwordForm"},a.a.createElement("div",{className:"form-group"},a.a.createElement("h4",null,s.a.t("login.enter-login-password"))),a.a.createElement("div",{className:"form-group"},a.a.createElement("div",{className:"input-group mb-3"},a.a.createElement("div",{className:"input-group-prepend"},a.a.createElement("label",{className:"input-group-text",htmlFor:"username"},s.a.t("login.login"))),e)),a.a.createElement("div",{className:"form-group"},a.a.createElement("div",{className:"input-group mb-3"},a.a.createElement("div",{className:"input-group-prepend"},a.a.createElement("label",{className:"input-group-text",htmlFor:"password"},s.a.t("login.password"))),a.a.createElement("input",{type:"password",className:"form-control",name:"password",id:"password",required:"",placeholder:s.a.t("login.password-placeholder"),value:this.state.password,onChange:this.handleChangePassword,autoFocus:!!this.state.currentUser}))),a.a.createElement("div",{className:"row"},a.a.createElement("div",{className:"col-md-3"},a.a.createElement("button",{type:"submit",name:"loginbut",id:"loginbut",className:"btn btn-primary btn-lg btn-block",onClick:function(e){return n.validateLogin(e)},title:s.a.t("login.sign-in-title")},s.a.t("login.btn-ok"))),a.a.createElement("div",{className:"col-md-9 text-right mt-2"},t)))}}]),t}();function Te(e){return(Te="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ge(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Me(e,t){return(Me=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function qe(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function De(e){return(De=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Ve=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Me(e,t)}(t,r.Component);var e=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=De(e);if(t){var a=De(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return function(e,t){return!t||"object"!==Te(t)&&"function"!=typeof t?qe(e):t}(this,n)}}(t);function t(n){var r;return function(e,n){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),(r=e.call(this,n)).state={config:n.config,username:n.username,usernameValidated:!1,scheme:n.scheme,userList:n.userList},r.handleChangeUsername=r.handleChangeUsername.bind(qe(r)),r.validateUsername=r.validateUsername.bind(qe(r)),r}return function(e,t,n){t&&Ge(e.prototype,t)}(t,[{key:"componentWillReceiveProps",value:function(e){this.setState({config:e.config,username:e.username,scheme:e.scheme,userList:e.userList})}},{key:"handleChangeUsername",value:function(e){this.setState({username:e.target.value})}},{key:"validateUsername",value:function(e){e.preventDefault(),this.state.username&&this.setState({usernameValidated:!0})}},{key:"gotoManageUsers",value:function(){f.a.sendMessage("App",{type:"SelectAccount"})}},{key:"render",value:function(){var e,t=this;if(0<this.state.userList.length&&(e=a.a.createElement("button",{type:"button",className:"btn btn-secondary",onClick:this.gotoManageUsers},s.a.t("login.manage-users"))),this.state.usernameValidated){var n=!1;return this.state.config.sessionSchemes.forEach(function(e){e.scheme_name===t.state.scheme&&(n="mock"===e.scheme_type?a.a.createElement(C,{config:t.state.config,scheme:e,currentUser:{username:t.state.username}}):"email"===e.scheme_type?a.a.createElement(G,{config:t.state.config,scheme:e,currentUser:{username:t.state.username}}):"webauthn"===e.scheme_type?a.a.createElement(F,{config:t.state.config,scheme:e,currentUser:{username:t.state.username}}):"otp"===e.scheme_type?a.a.createElement(K,{config:t.state.config,scheme:e,currentUser:{username:t.state.username}}):"retype-password"===e.scheme_type||"http"===e.scheme_type?a.a.createElement(te,{config:t.state.config,scheme:e,currentUser:{username:t.state.username}}):"certificate"===e.scheme_type?a.a.createElement(se,{config:t.state.config,scheme:e,currentUser:{username:t.state.username}}):"oauth2"===e.scheme_type?a.a.createElement(me,{config:t.state.config,scheme:e,currentUser:{username:t.state.username}}):a.a.createElement("div",null,"No can do"))}),a.a.createElement("div",null,a.a.createElement("div",{className:"form-group"},a.a.createElement("h4",null,s.a.t("login.welcome-login",{username:this.state.username}))),a.a.createElement("div",{className:"form-group"},n),a.a.createElement("div",{className:"form-group"},a.a.createElement("div",{className:"row"},a.a.createElement("div",{className:"col-md-12 text-right mt-2"},e))))}return a.a.createElement("form",{action:"#",id:"passwordForm"},a.a.createElement("div",{className:"form-group"},a.a.createElement("h4",null,s.a.t("login.enter-login"))),a.a.createElement("div",{className:"form-group"},a.a.createElement("div",{className:"input-group mb-3"},a.a.createElement("div",{className:"input-group-prepend"},a.a.createElement("label",{className:"input-group-text",htmlFor:"username"},s.a.t("login.login"))),a.a.createElement("input",function(e,t,n){return t in e?Object.defineProperty(e,t,{value:!0,enumerable:!0,configurable:!0,writable:!0}):e[t]=!0,e}({type:"text",className:"form-control",name:"username",id:"username",autoFocus:!0,required:"",placeholder:s.a.t("login.login-placeholder"),value:this.state.username,onChange:this.handleChangeUsername},"autoFocus")))),a.a.createElement("div",{className:"row"},a.a.createElement("div",{className:"col-md-3"},a.a.createElement("button",{type:"submit",name:"usernamebut",id:"usernamebut",className:"btn btn-primary btn-lg btn-block",onClick:function(e){return t.validateUsername(e)},title:s.a.t("login.sign-in-title")},s.a.t("login.btn-ok"))),a.a.createElement("div",{className:"col-md-9 text-right mt-2"},e)))}}]),t}();function Ie(e){return(Ie="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Fe(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function We(e,t){return(We=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Be(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Je(e){return(Je=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var ze=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&We(e,t)}(t,r.Component);var e=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Je(e);if(t){var a=Je(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return function(e,t){return!t||"object"!==Ie(t)&&"function"!=typeof t?Be(e):t}(this,n)}}(t);function t(n){var r;return function(e,n){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),(r=e.call(this,n)).state={config:n.config,userList:n.userList||[],currentUser:n.currentUser||[]},r.handleBack=r.handleBack.bind(Be(r)),r.handleToggleGrantScope=r.handleToggleGrantScope.bind(Be(r)),r.handleNewAccount=r.handleNewAccount.bind(Be(r)),r.handleLogoutAccount=r.handleLogoutAccount.bind(Be(r)),r}return function(e,t,n){t&&Fe(e.prototype,t)}(t,[{key:"componentWillReceiveProps",value:function(e){this.setState({config:e.config,userList:e.userList||[],currentUser:e.currentUser||[]})}},{key:"handleBack",value:function(){f.a.sendMessage("App",{type:"SelectAccountComplete"})}},{key:"handleToggleGrantScope",value:function(e){var t=this;this.setState({currentUser:e},function(){return u.a.glewlwydRequest("/auth/","POST",{username:t.state.currentUser.username}).then(function(){f.a.sendMessage("Notification",{type:"success",message:s.a.t("login.select-login",{username:t.state.currentUser.username})})}).fail(function(){f.a.sendMessage("Notification",{type:"danger",message:s.a.t("login.error-login")})})})}},{key:"handleNewAccount",value:function(){f.a.sendMessage("App",{type:"NewUser"})}},{key:"handleLogoutAccount",value:function(e){u.a.glewlwydRequest("/auth/?username="+e,"DELETE").then(function(){f.a.sendMessage("App",{type:"InitProfile"})}).fail(function(){f.a.sendMessage("Notification",{type:"danger",message:s.a.t("login.error-login")})})}},{key:"handleLogoutAll",value:function(){u.a.glewlwydRequest("/auth/","DELETE").then(function(){f.a.sendMessage("App",{type:"SessionClosed"})}).fail(function(){f.a.sendMessage("Notification",{type:"danger",message:s.a.t("login.error-login")})})}},{key:"render",value:function(){var e,t=this,n=[],r=-1;return this.state.userList.forEach(function(e,n){e.username===t.state.currentUser.username&&(r=n)}),this.state.userList.forEach(function(o,c){var i;if(o.picture){var l=o.picture;e=a.a.createElement("img",{className:"img-thumb glwd-select-user-picture",src:"data:*;base64,"+l})}else e=a.a.createElement("i",{className:"fas fa-user glwd-select-user-picto"});i=a.a.createElement("div",{className:"input-group",id:"select-user-"+o.username},a.a.createElement("label",{className:"glwd-select-user-label"},a.a.createElement("div",{className:"col input-group-prepend glwd-select-user-col"},e),a.a.createElement("input",{type:"radio",className:"input-hidden",onChange:function(){return t.handleToggleGrantScope(o)},name:"select-user"}),a.a.createElement("div",{className:"col input-group-append glwd-select-user-username"},a.a.createElement("div",{className:"col btn-icon-left glwd-select-user-username v-align-middle"},o.name||o.username),a.a.createElement("button",{type:"button",disabled:!0,className:"glwd-select-user-hidden-button"},a.a.createElement("img",{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mP8z/C/HgAGgwJ/lK3Q6wAAAABJRU5ErkJggg=="}))))),n.push(a.a.createElement("li",{className:"list-group-item"+(r===c?" active":""),key:c},a.a.createElement("div",{className:"row"},a.a.createElement("div",{className:"col glwd-no-padding-right"},i),a.a.createElement("div",{className:"col-auto text-right glwd-no-padding-left"},a.a.createElement("button",{type:"button",className:"btn btn-secondary",onClick:function(){return t.handleLogoutAccount(o.username)}},s.a.t("login.logout"))))))}),a.a.createElement("div",null,a.a.createElement("div",{className:"row"},a.a.createElement("div",{className:"col-md-12"},a.a.createElement("h4",null,s.a.t("login.select-acount-title")))),a.a.createElement("div",{className:"row"},a.a.createElement("div",{className:"col-md-12"},a.a.createElement("ul",{className:"list-group"},n))),a.a.createElement("div",{className:"row"},a.a.createElement("div",{className:"col-md-12"},a.a.createElement("hr",null))),a.a.createElement("div",{className:"row"},a.a.createElement("div",{className:"col-md-6"},a.a.createElement("div",{className:"btn-group",role:"group"},a.a.createElement("button",{type:"button",className:"btn btn-primary",onClick:this.handleBack},s.a.t("login.back")),a.a.createElement("button",{type:"button",className:"btn btn-primary",onClick:this.handleNewAccount},s.a.t("login.login-another-new")))),a.a.createElement("div",{className:"col-md-6 text-right"},a.a.createElement("button",{type:"button",className:"btn btn-danger",onClick:this.handleLogoutAll},s.a.t("login.logout-all")))),a.a.createElement("div",{className:"row"},a.a.createElement("div",{className:"col-md-12"},a.a.createElement("hr",null))))}}]),t}();function He(e){return(He="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function $e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ke(e,t){return(Ke=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Qe(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ye(e){return(Ye=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Xe=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ke(e,t)}(t,r.Component);var e=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=Ye(e);if(t){var a=Ye(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return function(e,t){return!t||"object"!==He(t)&&"function"!=typeof t?Qe(e):t}(this,n)}}(t);function t(n){var r;return function(e,n){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),(r=e.call(this,n)).state={config:n.config,userList:n.userList||[],currentUser:n.currentUser||[]},r.handleLogout=r.handleLogout.bind(Qe(r)),r.handleIgnoreLogout=r.handleIgnoreLogout.bind(Qe(r)),r}return function(e,t,n){t&&$e(e.prototype,t)}(t,[{key:"componentWillReceiveProps",value:function(e){this.setState({config:e.config,userList:e.userList||[],currentUser:e.currentUser||[]})}},{key:"handleLogout",value:function(){var e=this;u.a.glewlwydRequest("/auth/","DELETE").fail(function(){f.a.sendMessage("Notification",{type:"danger",message:s.a.t("login.error-delete-session")})}).always(function(){e.state.config.params.callback_url?document.location.href=e.state.config.params.callback_url:f.a.sendMessage("App",{type:"SessionClosed"})})}},{key:"handleIgnoreLogout",value:function(){document.location.href=this.state.config.params.callback_url}},{key:"render",value:function(){var e;return this.state.config.params.callback_url&&(e=a.a.createElement("button",{type:"button",className:"btn btn-primary btn-icon-right",onClick:this.handleIgnoreLogout},s.a.t("login.ignore-logout"))),a.a.createElement("div",null,a.a.createElement("div",{className:"row"},a.a.createElement("div",{className:"col-md-12"},a.a.createElement("h3",null,s.a.t("login.end-session-title")))),a.a.createElement("div",{className:"row"},a.a.createElement("div",{className:"col-md-12"},a.a.createElement("h4",null,s.a.t("login.end-session-message")))),a.a.createElement("div",{className:"row"},a.a.createElement("div",{className:"col-md-12"},a.a.createElement("hr",null))),a.a.createElement("div",{className:"row"},a.a.createElement("div",{className:"col-md-12"},a.a.createElement("button",{type:"button",className:"btn btn-primary btn-icon",onClick:this.handleLogout},a.a.createElement("i",{className:"fas fa-sign-out-alt btn-icon"}),s.a.t("login.logout")),e)))}}]),t}();function Ze(e){return(Ze="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function et(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function tt(e,t){return(tt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function nt(e){return(nt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var rt=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&tt(e,t)}(t,r.Component);var e=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=nt(e);if(t){var a=nt(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return function(e,t){return!t||"object"!==Ze(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}(this,n)}}(t);function t(n){var r;return function(e,n){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),(r=e.call(this,n)).state={config:n.config},r}return function(e,t,n){t&&et(e.prototype,t)}(t,[{key:"render",value:function(){return a.a.createElement("div",null,a.a.createElement("div",{className:"row"},a.a.createElement("div",{className:"col-md-12 text-center"},a.a.createElement("h3",null,s.a.t("login.session-closed-title")))),a.a.createElement("hr",null),a.a.createElement("div",{className:"row"},a.a.createElement("div",{className:"col-md-12 text-center"},a.a.createElement("h4",null,s.a.t("login.session-closed-message")))))}}]),t}();function at(e){return(at="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ot(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ct(e,t){return(ct=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function st(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function it(e){return(it=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var lt=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ct(e,t)}(t,r.Component);var e=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=it(e);if(t){var a=it(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return function(e,t){return!t||"object"!==at(t)&&"function"!=typeof t?st(e):t}(this,n)}}(t);function t(n){var r;return function(e,n){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),(r=e.call(this,n)).state={config:n.config,userCode:""},r.handleValidCode=r.handleValidCode.bind(st(r)),r.handleChangeUserCode=r.handleChangeUserCode.bind(st(r)),r}return function(e,t,n){t&&ot(e.prototype,t)}(t,[{key:"componentWillReceiveProps",value:function(e){this.setState({config:e.config,userCode:""})}},{key:"handleChangeUserCode",value:function(e){var t=e.target.value.replace(/[\W\s\._\-]+/g,"").toUpperCase();8<t.length&&(t=t.substring(0,8)),4<=t.length&&(t=t.substring(0,4)+"-"+t.substring(4)),this.setState({userCode:t})}},{key:"handleValidCode",value:function(){document.location=this.state.config.params.callback_url+"?code="+this.state.userCode}},{key:"render",value:function(){var e,t;return"deviceComplete"===this.state.config.params.prompt?e=a.a.createElement("div",{className:"row"},a.a.createElement("div",{className:"col-md-12"},a.a.createElement("h4",null,s.a.t("login.device-authorization-complete-message")))):"deviceServerError"===this.state.config.params.prompt?e=a.a.createElement("div",{className:"row"},a.a.createElement("div",{className:"col-md-12"},a.a.createElement("h4",null,s.a.t("login.device-authorization-server-error-message")))):(e="deviceCodeError"===this.state.config.params.prompt?a.a.createElement("div",null,a.a.createElement("div",{className:"row"},a.a.createElement("div",{className:"col-md-12"},a.a.createElement("h4",null,s.a.t("login.device-authorization-message"))),a.a.createElement("div",{className:"form-group"},a.a.createElement("div",{className:"input-group mb-3"},a.a.createElement("div",{className:"input-group-prepend"},a.a.createElement("label",{className:"input-group-text",htmlFor:"username"},s.a.t("login.device-auth-user-code"))),a.a.createElement("input",{type:"text",maxLength:"9",placeholder:s.a.t("login.device-auth-user-code-ph"),value:this.state.userCode,onChange:this.handleChangeUserCode})))),a.a.createElement("div",{className:"row"},a.a.createElement("div",{className:"col-md-12"},a.a.createElement("h4",null,s.a.t("login.device-authorization-code-error-message"))))):a.a.createElement("div",{className:"row"},a.a.createElement("div",{className:"col-md-12"},a.a.createElement("h4",null,s.a.t("login.device-authorization-message"))),a.a.createElement("div",{className:"form-group"},a.a.createElement("div",{className:"input-group mb-3"},a.a.createElement("div",{className:"input-group-prepend"},a.a.createElement("label",{className:"input-group-text",htmlFor:"username"},s.a.t("login.device-auth-user-code"))),a.a.createElement("input",{type:"text",maxLength:"9",placeholder:s.a.t("login.device-auth-user-code-ph"),value:this.state.userCode,onChange:this.handleChangeUserCode})))),t=a.a.createElement("button",{type:"button",className:"btn btn-primary btn-icon",onClick:this.handleValidCode,disabled:this.state.userCode.length<9},a.a.createElement("i",{className:"fas fa-sign-out-alt btn-icon"}),s.a.t("login.btn-ok"))),a.a.createElement("div",null,a.a.createElement("div",{className:"row"},a.a.createElement("div",{className:"col-md-12"},a.a.createElement("h3",null,s.a.t("login.device-authorization-title")))),a.a.createElement("hr",null),e,a.a.createElement("div",{className:"row"},a.a.createElement("div",{className:"col-md-12"},t)))}}]),t}();function ut(e){return(ut="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ft(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function mt(e,t){return(mt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function pt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ht(e){return(ht=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function dt(e,t){t=t||window.location.href,e=e.replace(/[\[\]]/g,"\\$&");var n=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(t);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null}var gt=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&mt(e,t)}(t,r.Component);var e=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=ht(e);if(t){var a=ht(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return function(e,t){return!t||"object"!==ut(t)&&"function"!=typeof t?pt(e):t}(this,n)}}(t);function t(n){var r;return function(e,n){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),(r=e.call(this,n)).state={newUser:!1,userList:[],currentUser:!1,config:n.config,loaded:!1,lang:s.a.language,scope:[],mustRegisterScheme:!1,scheme:n.config.params.scheme,schemeListRequired:!1,passwordRequired:!1,client:!1,showGrant:!0,showGrantAsterisk:!1,canContinue:!1,prompt:n.config.params.prompt,refresh_login:n.config.params.refresh_login,forceShowGrant:!1,selectAccount:!1,endSession:!1,sessionClosed:!1,deviceAuth:!1,login_hint:n.config.params.login_hint||"",errorScopesUnavailable:!1,infoSomeScopeUnavailable:!1,errorScheme:!1},r.initProfile=r.initProfile.bind(pt(r)),r.checkClientScope=r.checkClientScope.bind(pt(r)),r.checkScopeScheme=r.checkScopeScheme.bind(pt(r)),r.changeLang=r.changeLang.bind(pt(r)),r.parseSchemes=r.parseSchemes.bind(pt(r)),r.state.config&&r.initProfile(!0),f.a.subscribe("App",function(e){"InitProfile"===e.type?r.initProfile(!1):"loginSuccess"===e.type?r.setState({selectAccount:!1,newUser:!1,refresh_login:!1,prompt:!1},function(){r.initProfile(!1)}):"NewUser"===e.type?r.setState({selectAccount:!1,newUser:!0,currentUser:!1,scheme:r.state.config.params.scheme},function(){}):"GrantComplete"===e.type?r.setState({selectAccount:!1,showGrant:!1,prompt:!1,forceShowGrant:!1},function(){r.initProfile(!1)}):"SelectAccount"===e.type?r.setState({selectAccount:!0,newUser:!1},function(){r.initProfile(!1)}):"SelectAccountComplete"===e.type?r.setState({selectAccount:!1,prompt:!1},function(){r.initProfile(!1)}):"ToggleGrant"===e.type?r.setState({showGrant:!r.state.showGrant}):"newUserScheme"===e.type?r.setState({scheme:e.scheme}):"SessionClosed"===e.type&&r.setState({endSession:!1,sessionClosed:!0})}),r}return function(e,t,n){t&&ft(e.prototype,t)}(t,[{key:"initProfile",value:function(e){var t=this;u.a.glewlwydRequest("/profile_list").then(function(n){var r={};n.length&&(r.currentUser=n[0],r.login_hint=n[0].username,r.errorScopesUnavailable=!t.userHasScope(n[0],t.state.config.params.scope)),r.userList=n,r.loaded=!0,e&&("login"===t.state.prompt?(r.currentUser=!1,r.newUser=!0):"consent"===t.state.prompt?r.forceShowGrant=!0:"select_account"===t.state.prompt?r.selectAccount=!0:"end_session"===t.state.prompt?(r.endSession=!0,r.newUser=!1,r.currentUser=!1):t.state.prompt&&"device"===t.state.prompt.substring(0,6)?r.deviceAuth=!0:r.newUser=!1),t.setState(r,function(){t.state.config.params.client_id&&t.state.config.params.scope?t.checkClientScope(t.state.config.params.client_id,t.state.config.params.scope):t.state.config.params.scope?t.checkScopeScheme(t.state.config.params.scope):t.setState({showGrantAsterisk:!1})})}).fail(function(e){401!=e.status&&f.a.sendMessage("Notification",{type:"warning",message:s.a.t("error-api-connect")}),"device"===t.state.prompt?t.setState({deviceAuth:!0,currentUser:!1,userList:[],loaded:!0}):t.setState({newUser:!!t.state.config.params.callback_url&&!!t.state.config.params.scope,showGrant:!1,currentUser:!1,userList:[],loaded:!0})})}},{key:"checkClientScope",value:function(e,t){var n=this;u.a.glewlwydRequest("/auth/grant/"+encodeURIComponent(e)+"/"+encodeURIComponent(t)).then(function(e){var r=[],a=!0,o=!1;if(e.scope.length){var c=t.split(" ").length>e.scope.length;"openid"===t?(a=n.state.forceShowGrant,r.push("openid")):e.scope.forEach(function(e){"openid"===e.name&&(e.granted=!0),e.granted?("openid"!==e.name&&(a=n.state.forceShowGrant),r.push(e.name)):o=!0}),r.length?u.a.glewlwydRequest("/auth/scheme/?scope="+encodeURIComponent(r.join(" "))).then(function(t){n.setState({client:e.client,scope:e.scope,scheme:t,showGrant:a,showGrantAsterisk:o,infoSomeScopeUnavailable:c,errorScopesUnavailable:!1},function(){n.parseSchemes()})}).fail(function(e){f.a.sendMessage("Notification",{type:"warning",message:s.a.t("login.error-scheme-scope-api")})}):n.setState({client:e.client,scope:e.scope,showGrant:!0,showGrantAsterisk:!0,errorScopesUnavailable:!1,infoSomeScopeUnavailable:c})}else n.setState({errorScopesUnavailable:!0,infoSomeScopeUnavailable:!1})}).fail(function(e){404===e.status?f.a.sendMessage("Notification",{type:"warning",message:s.a.t("login.error-scheme-scope-unavailable")}):f.a.sendMessage("Notification",{type:"warning",message:s.a.t("login.error-grant-api")})})}},{key:"checkScopeScheme",value:function(e){var t=this;u.a.glewlwydRequest("/auth/scheme/?scope="+e).then(function(e){t.setState({scheme:e,showGrant:!1,showGrantAsterisk:!1},function(){t.parseSchemes()})}).fail(function(e){404===e.status?f.a.sendMessage("Notification",{type:"warning",message:s.a.t("login.error-scheme-scope-unavailable")}):f.a.sendMessage("Notification",{type:"warning",message:s.a.t("login.error-scheme-scope-api")})})}},{key:"parseSchemes",value:function(){var e=!!this.state.config.params.callback_url,t=!1,n=!1,r=!1,a=!1;for(var o in this.state.scheme)if(e){var c=this.state.scheme[o];if(c.available&&c.password_required&&!c.password_authenticated){r=n=!(t=!(e=!1));break}if(!n&&e)for(var s in c.schemes){var i=c.schemes[s],l=!1;if((n=i).forEach(function(e){a=!1,e.scheme_authenticated?r=n=!(l=!0):(!r||r.scheme_last_login<e.scheme_last_login)&&e.scheme_registered?r=e:e.scheme_registered||r||(a=!0)}),!l){e=!1;break}}}!t&&this.state.refresh_login&&(t=!0),e&&(r=!1),this.setState({canContinue:e,passwordRequired:t,schemeListRequired:n,scheme:r,errorScheme:!r&&!e,mustRegisterScheme:a})}},{key:"changeLang",value:function(e,t){var n=this;s.a.changeLanguage(t).then(function(){n.setState({lang:t})})}},{key:"userHasScope",value:function(e,t){var n=!1;return t&&t.split(" ").forEach(function(t){-1<e.scope.indexOf(t)&&(n=!0)}),n}},{key:"render",value:function(){var e=this;if(this.state.config){var t,n,r="";if(this.state.loaded)if(this.state.endSession)r=a.a.createElement(Xe,{config:this.state.config,userList:this.state.userList,currentUser:this.state.currentUser});else if(this.state.sessionClosed)r=a.a.createElement(rt,{config:this.state.config});else if(this.state.deviceAuth)r=a.a.createElement(lt,{config:this.state.config,userList:this.state.userList,currentUser:this.state.currentUser});else{if(this.state.mustRegisterScheme&&!this.state.errorScopesUnavailable)t=a.a.createElement("div",{className:"alert alert-warning",role:"alert"},s.a.t("login.warning-not-registered-scheme"));else if(this.state.errorScheme&&!this.state.errorScopesUnavailable)t=a.a.createElement("div",{className:"alert alert-warning",role:"alert"},s.a.t("login.warning-error-scheme"));else{var o,c;this.state.config.params.callback_url||(o=a.a.createElement("div",{className:"alert alert-warning",role:"alert"},s.a.t("login.warning-no-callback-url"))),this.state.config.params.scope||(c=a.a.createElement("div",{className:"alert alert-warning",role:"alert"},s.a.t("login.warning-no-scope"))),t=a.a.createElement("div",null,o,c)}this.state.newUser||this.state.passwordRequired?r=this.state.scheme?a.a.createElement(Ve,{config:this.state.config,username:this.state.login_hint,userList:this.state.userList,callbackInitProfile:this.initProfile,scheme:this.state.scheme}):a.a.createElement(Ae,{config:this.state.config,username:this.state.login_hint,currentUser:this.state.currentUser,userList:this.state.userList,callbackInitProfile:this.initProfile}):this.state.selectAccount?r=a.a.createElement(ze,{config:this.state.config,userList:this.state.userList,currentUser:this.state.currentUser}):(r=a.a.createElement(Pe,{config:this.state.config,currentUser:this.state.currentUser,client:this.state.client,scope:this.state.scope,scheme:this.state.scheme,schemeListRequired:this.state.schemeListRequired,showGrant:this.state.showGrant,infoSomeScopeUnavailable:this.state.infoSomeScopeUnavailable,validLogin:!!this.state.config.params.callback_url&&!!this.state.config.params.scope}),this.state.errorScopesUnavailable&&(n=a.a.createElement("div",{className:"alert alert-danger",role:"alert"},s.a.t("login.error-scope-unavailable"))))}var i=[];return this.state.config.lang.forEach(function(t,n){t===s.a.language?i.push(a.a.createElement("a",{className:"dropdown-item active",href:"#",key:n},t)):i.push(a.a.createElement("a",{className:"dropdown-item",href:"#",onClick:function(n){return e.changeLang(n,t)},key:n},t))}),a.a.createElement("div",{"aria-live":"polite","aria-atomic":"true",className:"glwd-container"},a.a.createElement("div",{className:"card center glwd-card",id:"userCard",tabIndex:"-1",role:"dialog"},a.a.createElement("div",{className:"card-header"},a.a.createElement("nav",{className:"navbar navbar-expand-lg navbar-light"},a.a.createElement("a",{className:"navbar-brand",href:"#","data-toggle":"collapse"},a.a.createElement("img",{className:"mr-3",src:"img/logo-login.png",alt:"logo"}),s.a.t("login.menu-title")),a.a.createElement("button",{className:"navbar-toggler",type:"button","data-toggle":"collapse","data-target":"#navbarSupportedContent","aria-controls":"navbarSupportedContent","aria-expanded":"false","aria-label":"Toggle navigation"},a.a.createElement("span",{className:"navbar-toggler-icon"})),a.a.createElement("div",{className:"collapse navbar-collapse",id:"navbarSupportedContent"},a.a.createElement("ul",{className:"navbar-nav mr-auto"}),a.a.createElement("div",{className:"btn-group",role:"group"},a.a.createElement("button",{className:"btn btn-secondary dropdown-toggle",type:"button",id:"dropdownLang","data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false"},a.a.createElement("i",{className:"fas fa-language"})),a.a.createElement("div",{className:"dropdown-menu","aria-labelledby":"dropdownLang"},i))))),t,a.a.createElement("div",{className:"card-body"},n,r),a.a.createElement("div",{className:"card-footer"},a.a.createElement(b,{config:this.state.config,currentUser:this.state.currentUser,userList:this.state.userList,client:this.state.client,showGrant:this.state.showGrant,showGrantAsterisk:this.state.showGrantAsterisk,newUser:this.state.newUser,newUserScheme:this.state.scheme,canContinue:this.state.canContinue&&!this.state.errorScopesUnavailable,schemeListRequired:this.state.schemeListRequired,selectAccount:this.state.selectAccount}))),a.a.createElement(m.a,{loggedIn:!0}))}return a.a.createElement("div",{"aria-live":"polite","aria-atomic":"true",className:"glwd-container"},a.a.createElement("div",{className:"card center glwd-card",id:"userCard",tabIndex:"-1",role:"dialog"},a.a.createElement("div",{className:"card-header"},a.a.createElement("h4",null,a.a.createElement("span",{className:"badge badge-danger"},s.a.t("error-api-connect"))))))}}]),t}(),yt=n(8),bt={fallbackLng:"en",ns:["translations"],defaultNS:"translations",backend:{loadPath:"locales/{{lng}}/{{ns}}.json"}};dt("ui_locales")&&(bt.lng=dt("ui_locales").split(" ")[0]);try{s.a.use(i.a).use(l.a).init(bt).then(function(){u.a.request("config.json").then(function(e){e.lang||(e.lang=["en","fr","nl"]),u.a.request(e.GlewlwydUrl+"config/").then(function(t){u.a.setConfig(e.GlewlwydUrl+t.api_prefix);var n=Object.assign({params:{scope:dt("scope")||!1,client_id:dt("client_id")||!1,callback_url:dt("callback_url")||!1,scheme:dt("scheme")||e.defaultScheme||!1,prompt:dt("prompt")||!1,refresh_login:!!dt("refresh_login"),login_hint:dt("login_hint")||!1}},e,t);c.a.render(a.a.createElement(gt,{config:n}),document.getElementById("root"))}).fail(function(e){c.a.render(a.a.createElement(gt,{config:!1}),document.getElementById("root"))})}).fail(function(e){c.a.render(a.a.createElement(yt.a,null),document.getElementById("root"))})})}catch(e){$("#root").html('<div class="alert alert-danger" role="alert"><i class="fas fa-exclamation-triangle"></i><span class="btn-icon-right">You must use a browser compatible with Glewlwyd SSO</span></div>')}},3:function(e,t,n){"use strict";var r=n(2);function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var o=new(function(){function e(){!function(t,n){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this),this.GlewlwydApiPrefix="",this.GlewlwydApiPrefixSub=""}return function(e,t,n){t&&a(e.prototype,t)}(e,[{key:"setConfig",value:function(e){this.GlewlwydApiPrefix=e}},{key:"getConfig",value:function(e){return this.GlewlwydApiPrefix}},{key:"setConfigSub",value:function(e){this.GlewlwydApiPrefixSub=e}},{key:"getConfigSub",value:function(e){return this.GlewlwydApiPrefixSub}},{key:"request",value:function(e,t,n){var r=1<arguments.length&&void 0!==t?t:"GET",a=2<arguments.length&&void 0!==n&&n;return a&&"GET"!==r?$.ajax({method:r,url:e,data:JSON.stringify(a),contentType:"application/json; charset=utf-8"}):$.ajax({method:r,url:e})}},{key:"glewlwydRequest",value:function(e,t,n,a){var o=1<arguments.length&&void 0!==t?t:"GET",c=2<arguments.length&&void 0!==n&&n,s=3<arguments.length&&void 0!==a&&a;return this.request(this.GlewlwydApiPrefix+e,o,c).fail(function(e){s&&401===e.status&&r.a.sendMessage("App",{type:"loggedIn",message:!1})})}},{key:"glewlwydRequestSub",value:function(e,t,n){var r=1<arguments.length&&void 0!==t?t:"GET",a=2<arguments.length&&void 0!==n&&n;return this.request(this.GlewlwydApiPrefixSub+e,r,a)}}]),e}());t.a=o},4:function(e,t,n){"use strict";var r=n(0),a=n.n(r),o=n(2);function c(e){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t){return(i=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function l(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var f=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&i(e,t)}(t,r.Component);var e=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=u(e);if(t){var a=u(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return function(e,t){return!t||"object"!==c(t)&&"function"!=typeof t?l(e):t}(this,n)}}(t);function t(n){var r;return function(e,n){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),(r=e.call(this,n)).state={message:[],counter:0,loggedIn:n.loggedIn},o.a.subscribe("Notification",function(e){if(e.type){var t=r.state.message;t.push({type:e.type,message:e.message,id:r.state.counter}),r.setState({message:t,counter:r.state.counter+1},function(){r.timeoutClose(r.state.counter-1)})}}),r.close=r.close.bind(l(r)),r.timeoutClose=r.timeoutClose.bind(l(r)),r}return function(e,t,n){t&&s(e.prototype,t)}(t,[{key:"componentWillReceiveProps",value:function(e){this.setState({loggedIn:e.loggedIn})}},{key:"timeoutClose",value:function(e){var t=this;setTimeout(function(){t.close(e)},5e3)}},{key:"close",value:function(e){var t=this,n=this.state.message;n.forEach(function(r,a){r.id===e&&(n.splice(a,1),t.setState({message:n}))})}},{key:"render",value:function(){var e=this,t=[];return this.state.loggedIn&&this.state.message.forEach(function(n,r){var o;o="success"===n.type?a.a.createElement("strong",{className:"mr-auto"},a.a.createElement("span",{className:"badge badge-success btn-icon"},a.a.createElement("i",{className:"fas fa-check-circle"})),"Glewlwyd"):"danger"===n.type?a.a.createElement("strong",{className:"mr-auto"},a.a.createElement("span",{className:"badge badge-danger btn-icon"},a.a.createElement("i",{className:"fas fa-exclamation-circle"})),"Glewlwyd"):"warning"===n.type?a.a.createElement("strong",{className:"mr-auto"},a.a.createElement("span",{className:"badge badge-warning btn-icon"},a.a.createElement("i",{className:"fas fa-exclamation-circle"})),"Glewlwyd"):a.a.createElement("strong",{className:"mr-auto"},a.a.createElement("span",{className:"badge badge-info btn-icon"},a.a.createElement("i",{className:"fas fa-info-circle"})),"Glewlwyd"),t.push(a.a.createElement("div",{className:"toast-container",style:{top:95+90*r,right:5},key:r},a.a.createElement("div",{className:"toast glwd-toast",role:"alert","aria-live":"assertive","aria-atomic":"true"},a.a.createElement("div",{className:"toast-header"},o,a.a.createElement("button",{type:"button",className:"ml-2 mb-1 close","data-dismiss":"toast","aria-label":"Close",onClick:function(){return e.close(n.id)}},a.a.createElement("span",{"aria-hidden":"true"},""))),a.a.createElement("div",{className:"toast-body"},n.message))))}),a.a.createElement("div",null,t)}}]),t}();t.a=f},8:function(e,t,n){"use strict";var r=n(0),a=n.n(r),o=n(1);function c(e){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t){return(i=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var u=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&i(e,t)}(t,r.Component);var e=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=l(e);if(t){var a=l(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return function(e,t){return!t||"object"!==c(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}(this,n)}}(t);function t(n){return function(e,n){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),e.call(this,n)}return function(e,t,n){t&&s(e.prototype,t)}(t,[{key:"render",value:function(){return a.a.createElement("div",{className:"alert alert-danger perfect-centering",role:"alert"},o.a.t("error-config"))}}]),t}();t.a=u}})});